{"remainingRequest":"/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/node_modules/babel-loader/lib/index.js!/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/node_modules/ts-loader/index.js??ref--15-2!/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/node_modules/@vue/cli-plugin-eslint/node_modules/eslint-loader/index.js??ref--14-0!/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/src/plugins/webSocketClient.ts","dependencies":[{"path":"/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/src/plugins/webSocketClient.ts","mtime":1644874918000},{"path":"/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/node_modules/cache-loader/dist/cjs.js","mtime":1645990064605},{"path":"/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/node_modules/babel-loader/lib/index.js","mtime":1645990067759},{"path":"/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/node_modules/ts-loader/index.js","mtime":1645990068168},{"path":"/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/node_modules/@vue/cli-plugin-eslint/node_modules/eslint-loader/index.js","mtime":1645990065243}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIi9Vc2Vycy9hbm5lLXNvcGhpZXJveS9Eb3dubG9hZHMvTWFpbnNhaWwvbWFpbnNhaWwtbWFpbnRlbmFuY2Uvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2FzeW5jVG9HZW5lcmF0b3IuanMiOwppbXBvcnQgX2NsYXNzQ2FsbENoZWNrIGZyb20gIi9Vc2Vycy9hbm5lLXNvcGhpZXJveS9Eb3dubG9hZHMvTWFpbnNhaWwvbWFpbnNhaWwtbWFpbnRlbmFuY2Uvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NsYXNzQ2FsbENoZWNrLmpzIjsKaW1wb3J0IF9jcmVhdGVDbGFzcyBmcm9tICIvVXNlcnMvYW5uZS1zb3BoaWVyb3kvRG93bmxvYWRzL01haW5zYWlsL21haW5zYWlsLW1haW50ZW5hbmNlL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jcmVhdGVDbGFzcy5qcyI7CmltcG9ydCBfZGVmaW5lUHJvcGVydHkgZnJvbSAiL1VzZXJzL2FubmUtc29waGllcm95L0Rvd25sb2Fkcy9NYWluc2FpbC9tYWluc2FpbC1tYWludGVuYW5jZS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vZGVmaW5lUHJvcGVydHkuanMiOwppbXBvcnQgInJlZ2VuZXJhdG9yLXJ1bnRpbWUvcnVudGltZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zdGFydHMtd2l0aC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbmQuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZC1pbmRleC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNwbGljZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmpzb24uc3RyaW5naWZ5LmpzIjsKZXhwb3J0IHZhciBXZWJTb2NrZXRDbGllbnQgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogIGZ1bmN0aW9uIFdlYlNvY2tldENsaWVudChvcHRpb25zKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgV2ViU29ja2V0Q2xpZW50KTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgInVybCIsICcnKTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgImluc3RhbmNlIiwgbnVsbCk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJtYXhSZWNvbm5lY3RzIiwgNSk7CgogICAgX2RlZmluZVByb3BlcnR5KHRoaXMsICJyZWNvbm5lY3RJbnRlcnZhbCIsIDEwMDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAicmVjb25uZWN0cyIsIDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAia2VlcEFsaXZlVGltZW91dCIsIDEwMDApOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAidGltZXJJZCIsIG51bGwpOwoKICAgIF9kZWZpbmVQcm9wZXJ0eSh0aGlzLCAic3RvcmUiLCBudWxsKTsKCiAgICBfZGVmaW5lUHJvcGVydHkodGhpcywgIndhaXRzIiwgW10pOwoKICAgIHRoaXMudXJsID0gb3B0aW9ucy51cmw7CiAgICB0aGlzLm1heFJlY29ubmVjdHMgPSBvcHRpb25zLm1heFJlY29ubmVjdHMgfHwgNTsKICAgIHRoaXMucmVjb25uZWN0SW50ZXJ2YWwgPSBvcHRpb25zLnJlY29ubmVjdEludGVydmFsIHx8IDEwMDA7CiAgICB0aGlzLnN0b3JlID0gb3B0aW9ucy5zdG9yZTsKICB9CgogIF9jcmVhdGVDbGFzcyhXZWJTb2NrZXRDbGllbnQsIFt7CiAgICBrZXk6ICJzZXRVcmwiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldFVybCh1cmwpIHsKICAgICAgdGhpcy51cmwgPSB1cmw7CiAgICB9IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZQoKICB9LCB7CiAgICBrZXk6ICJwYXNzVG9TdG9yZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcGFzc1RvU3RvcmUoZXZlbnROYW1lLCBldmVudCkgewogICAgICB2YXIgX3RoaXMkc3RvcmU7CgogICAgICBpZiAoIWV2ZW50TmFtZS5zdGFydHNXaXRoKCdzb2NrZXQvJykpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIChfdGhpcyRzdG9yZSA9IHRoaXMuc3RvcmUpID09PSBudWxsIHx8IF90aGlzJHN0b3JlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfdGhpcyRzdG9yZS5kaXNwYXRjaChldmVudE5hbWUsIGV2ZW50KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJjb25uZWN0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfY29ubmVjdCA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIoKSB7CiAgICAgICAgdmFyIF90aGlzJHN0b3JlMiwKICAgICAgICAgICAgX3RoaXMgPSB0aGlzOwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MikgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgKF90aGlzJHN0b3JlMiA9IHRoaXMuc3RvcmUpID09PSBudWxsIHx8IF90aGlzJHN0b3JlMiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3RoaXMkc3RvcmUyLmRpc3BhdGNoKCdzb2NrZXQvc2V0RGF0YScsIHsKICAgICAgICAgICAgICAgICAgaXNDb25uZWN0aW5nOiB0cnVlCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBpZiAodGhpcy5pbnN0YW5jZSkgewogICAgICAgICAgICAgICAgICB0aGlzLmluc3RhbmNlLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhpcy5pbnN0YW5jZSA9IG5ldyBXZWJTb2NrZXQodGhpcy51cmwpOwoKICAgICAgICAgICAgICAgIHRoaXMuaW5zdGFuY2Uub25vcGVuID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICB2YXIgX3RoaXMkc3RvcmUzOwoKICAgICAgICAgICAgICAgICAgX3RoaXMucmVjb25uZWN0cyA9IDA7CiAgICAgICAgICAgICAgICAgIChfdGhpcyRzdG9yZTMgPSBfdGhpcy5zdG9yZSkgPT09IG51bGwgfHwgX3RoaXMkc3RvcmUzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfdGhpcyRzdG9yZTMuZGlzcGF0Y2goJ3NvY2tldC9vbk9wZW4nLCBldmVudCk7CiAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgIHRoaXMuaW5zdGFuY2Uub25jbG9zZSA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgIHZhciBfcmVmID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlKGUpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgX3RoaXMkc3RvcmU0OwoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoISghZS53YXNDbGVhbiAmJiBfdGhpcy5yZWNvbm5lY3RzIDwgX3RoaXMubWF4UmVjb25uZWN0cykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnJlY29ubmVjdHMrKzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5jb25uZWN0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBfdGhpcy5yZWNvbm5lY3RJbnRlcnZhbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoX3RoaXMkc3RvcmU0ID0gX3RoaXMuc3RvcmUpID09PSBudWxsIHx8IF90aGlzJHN0b3JlNCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3RoaXMkc3RvcmU0LmRpc3BhdGNoKCdzb2NrZXQvb25DbG9zZScsIGUpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LCBfY2FsbGVlKTsKICAgICAgICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChfeCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBfcmVmLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB9KCk7CgogICAgICAgICAgICAgICAgdGhpcy5pbnN0YW5jZS5vbmVycm9yID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICBpZiAoX3RoaXMuaW5zdGFuY2UpIF90aGlzLmluc3RhbmNlLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgIHRoaXMuaW5zdGFuY2Uub25tZXNzYWdlID0gZnVuY3Rpb24gKG1zZykgewogICAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IEpTT04ucGFyc2UobXNnLmRhdGEpOwoKICAgICAgICAgICAgICAgICAgaWYgKF90aGlzLnN0b3JlKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIF90aGlzJHN0b3JlNjsKCiAgICAgICAgICAgICAgICAgICAgdmFyIHdhaXQgPSBfdGhpcy5nZXRXYWl0QnlJZChkYXRhLmlkKTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKHdhaXQgJiYgd2FpdC5hY3Rpb24gIT09ICcnKSB7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgX2RhdGEkZXJyb3I7CgogICAgICAgICAgICAgICAgICAgICAgaWYgKChfZGF0YSRlcnJvciA9IGRhdGEuZXJyb3IpICE9PSBudWxsICYmIF9kYXRhJGVycm9yICE9PSB2b2lkIDAgJiYgX2RhdGEkZXJyb3IubWVzc2FnZSkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgX2RhdGEkZXJyb3IyOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCgoX2RhdGEkZXJyb3IyID0gZGF0YS5lcnJvcikgPT09IG51bGwgfHwgX2RhdGEkZXJyb3IyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZGF0YSRlcnJvcjIubWVzc2FnZSkgIT09ICdLbGlwcHkgRGlzY29ubmVjdGVkJykgd2luZG93LmNvbnNvbGUuZXJyb3IoJ1Jlc3BvbnNlIEVycm9yOiAnICsgd2FpdC5hY3Rpb24gKyAnID4gJyArIGRhdGEuZXJyb3IubWVzc2FnZSk7CiAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHdhaXQuYWN0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfdGhpcyRzdG9yZTU7CgogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gZGF0YS5yZXN1bHQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgPT09ICdvaycpIHJlc3VsdCA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQ6IHJlc3VsdAogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHJlc3VsdCA9PT0gJ3N0cmluZycpIHJlc3VsdCA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQ6IHJlc3VsdAogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcHJlbG9hZCA9IHt9OwogICAgICAgICAgICAgICAgICAgICAgICBpZiAod2FpdC5hY3Rpb25QYXlsb2FkKSBPYmplY3QuYXNzaWduKHByZWxvYWQsIHdhaXQuYWN0aW9uUGF5bG9hZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24ocHJlbG9hZCwgewogICAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3RQYXJhbXM6IHdhaXQucGFyYW1zCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHByZWxvYWQsIHJlc3VsdCk7CiAgICAgICAgICAgICAgICAgICAgICAgIChfdGhpcyRzdG9yZTUgPSBfdGhpcy5zdG9yZSkgPT09IG51bGwgfHwgX3RoaXMkc3RvcmU1ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfdGhpcyRzdG9yZTUuZGlzcGF0Y2god2FpdC5hY3Rpb24sIHByZWxvYWQpOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSAoX3RoaXMkc3RvcmU2ID0gX3RoaXMuc3RvcmUpID09PSBudWxsIHx8IF90aGlzJHN0b3JlNiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3RoaXMkc3RvcmU2LmRpc3BhdGNoKCdzb2NrZXQvb25NZXNzYWdlJywgZGF0YSk7CgogICAgICAgICAgICAgICAgICAgIGlmICh3YWl0KSBfdGhpcy5yZW1vdmVXYWl0QnlJZCh3YWl0LmlkKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUyLCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gY29ubmVjdCgpIHsKICAgICAgICByZXR1cm4gX2Nvbm5lY3QuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGNvbm5lY3Q7CiAgICB9KCkKICB9LCB7CiAgICBrZXk6ICJjbG9zZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2Nsb3NlID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMygpIHsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTMkKF9jb250ZXh0MykgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDMucHJldiA9IF9jb250ZXh0My5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgaWYgKCF0aGlzLmluc3RhbmNlKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMzsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAzOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaW5zdGFuY2UuY2xvc2UoKTsKCiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUzLCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gY2xvc2UoKSB7CiAgICAgICAgcmV0dXJuIF9jbG9zZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gY2xvc2U7CiAgICB9KCkKICB9LCB7CiAgICBrZXk6ICJnZXRXYWl0QnlJZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0V2FpdEJ5SWQoaWQpIHsKICAgICAgdmFyIF90aGlzJHdhaXRzJGZpbmQ7CgogICAgICByZXR1cm4gKF90aGlzJHdhaXRzJGZpbmQgPSB0aGlzLndhaXRzLmZpbmQoZnVuY3Rpb24gKHdhaXQpIHsKICAgICAgICByZXR1cm4gd2FpdC5pZCA9PT0gaWQ7CiAgICAgIH0pKSAhPT0gbnVsbCAmJiBfdGhpcyR3YWl0cyRmaW5kICE9PSB2b2lkIDAgPyBfdGhpcyR3YWl0cyRmaW5kIDogbnVsbDsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW1vdmVXYWl0QnlJZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlV2FpdEJ5SWQoaWQpIHsKICAgICAgdmFyIGluZGV4ID0gdGhpcy53YWl0cy5maW5kSW5kZXgoZnVuY3Rpb24gKHdhaXQpIHsKICAgICAgICByZXR1cm4gd2FpdC5pZCA9PT0gaWQ7CiAgICAgIH0pOwoKICAgICAgaWYgKGluZGV4KSB7CiAgICAgICAgdmFyIHdhaXQgPSB0aGlzLndhaXRzW2luZGV4XTsKCiAgICAgICAgaWYgKHdhaXQubG9hZGluZyAmJiB0aGlzLnN0b3JlKSB7CiAgICAgICAgICB0aGlzLnN0b3JlLmRpc3BhdGNoKCdzb2NrZXQvcmVtb3ZlTG9hZGluZycsIHsKICAgICAgICAgICAgbmFtZTogd2FpdC5sb2FkaW5nCiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIHRoaXMud2FpdHMuc3BsaWNlKGluZGV4LCAxKTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogImVtaXQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGVtaXQobWV0aG9kLCBwYXJhbXMpIHsKICAgICAgdmFyIF90aGlzJGluc3RhbmNlOwoKICAgICAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IHt9OwoKICAgICAgaWYgKCgoX3RoaXMkaW5zdGFuY2UgPSB0aGlzLmluc3RhbmNlKSA9PT0gbnVsbCB8fCBfdGhpcyRpbnN0YW5jZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3RoaXMkaW5zdGFuY2UucmVhZHlTdGF0ZSkgPT09IFdlYlNvY2tldC5PUEVOKSB7CiAgICAgICAgdmFyIF9vcHRpb25zJGFjdGlvbiwgX29wdGlvbnMkYWN0aW9uUGF5bG9hLCBfb3B0aW9ucyRsb2FkaW5nOwoKICAgICAgICB2YXIgaWQgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDAwMCkgKyAxOwogICAgICAgIHRoaXMud2FpdHMucHVzaCh7CiAgICAgICAgICBpZDogaWQsCiAgICAgICAgICBwYXJhbXM6IHBhcmFtcywKICAgICAgICAgIGFjdGlvbjogKF9vcHRpb25zJGFjdGlvbiA9IG9wdGlvbnMuYWN0aW9uKSAhPT0gbnVsbCAmJiBfb3B0aW9ucyRhY3Rpb24gIT09IHZvaWQgMCA/IF9vcHRpb25zJGFjdGlvbiA6IG51bGwsCiAgICAgICAgICBhY3Rpb25QYXlsb2FkOiAoX29wdGlvbnMkYWN0aW9uUGF5bG9hID0gb3B0aW9ucy5hY3Rpb25QYXlsb2FkKSAhPT0gbnVsbCAmJiBfb3B0aW9ucyRhY3Rpb25QYXlsb2EgIT09IHZvaWQgMCA/IF9vcHRpb25zJGFjdGlvblBheWxvYSA6IHt9LAogICAgICAgICAgbG9hZGluZzogKF9vcHRpb25zJGxvYWRpbmcgPSBvcHRpb25zLmxvYWRpbmcpICE9PSBudWxsICYmIF9vcHRpb25zJGxvYWRpbmcgIT09IHZvaWQgMCA/IF9vcHRpb25zJGxvYWRpbmcgOiBudWxsCiAgICAgICAgfSk7CgogICAgICAgIGlmIChvcHRpb25zLmxvYWRpbmcgJiYgdGhpcy5zdG9yZSkgewogICAgICAgICAgdGhpcy5zdG9yZS5kaXNwYXRjaCgnc29ja2V0L2FkZExvYWRpbmcnLCB7CiAgICAgICAgICAgIG5hbWU6IG9wdGlvbnMubG9hZGluZwogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICB2YXIgbXNnID0gSlNPTi5zdHJpbmdpZnkoewogICAgICAgICAganNvbnJwYzogJzIuMCcsCiAgICAgICAgICBtZXRob2Q6IG1ldGhvZCwKICAgICAgICAgIHBhcmFtczogcGFyYW1zLAogICAgICAgICAgaWQ6IGlkCiAgICAgICAgfSk7CiAgICAgICAgdGhpcy5pbnN0YW5jZS5zZW5kKG1zZyk7CiAgICAgIH0KICAgIH0KICB9XSk7CgogIHJldHVybiBXZWJTb2NrZXRDbGllbnQ7Cn0oKTsKZXhwb3J0IGZ1bmN0aW9uIFdlYlNvY2tldFBsdWdpbihWdWUsIG9wdGlvbnMpIHsKICB2YXIgc29ja2V0ID0gbmV3IFdlYlNvY2tldENsaWVudChvcHRpb25zKTsKICBWdWUucHJvdG90eXBlLiRzb2NrZXQgPSBzb2NrZXQ7CiAgVnVlLiRzb2NrZXQgPSBzb2NrZXQ7Cn0="},{"version":3,"sources":["/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/node_modules/@vue/cli-plugin-eslint/node_modules/eslint-loader/index.js??ref--14-0!/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/src/plugins/webSocketClient.ts"],"names":[],"mappings":";;;;;;;;;;;AAIA,WAAa,eAAb;AAWI,2BAAa,OAAb,EAA4C;AAAA;;AAAA,iCAVtC,EAUsC;;AAAA,sCATf,IASe;;AAAA,2CAR3B,CAQ2B;;AAAA,+CAPxB,IAOwB;;AAAA,wCAN/B,CAM+B;;AAAA,8CALzB,IAKyB;;AAAA,qCAJnB,IAImB;;AAAA,mCAHX,IAGW;;AAAA,mCAF5B,EAE4B;;AACxC,SAAK,GAAL,GAAW,OAAO,CAAC,GAAnB;AACA,SAAK,aAAL,GAAqB,OAAO,CAAC,aAAR,IAAyB,CAA9C;AACA,SAAK,iBAAL,GAAyB,OAAO,CAAC,iBAAR,IAA6B,IAAtD;AACA,SAAK,KAAL,GAAa,OAAO,CAAC,KAArB;AACH;;AAhBL;AAAA;AAAA,WAkBI,gBAAO,GAAP,EAAkB;AACd,WAAK,GAAL,GAAW,GAAX;AACH,KApBL,CAsBI;;AAtBJ;AAAA;AAAA,WAuBI,qBAAa,SAAb,EAAgC,KAAhC,EAA0C;AAAA;;AACtC,UAAI,CAAC,SAAS,CAAC,UAAV,CAAqB,SAArB,CAAL,EAAsC;AAAE;AAAQ;;AAEhD,0BAAK,KAAL,4DAAY,QAAZ,CAAqB,SAArB,EAAgC,KAAhC;AACH;AA3BL;AAAA;AAAA;AAAA,6EA6BI;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AACI,qCAAK,KAAL,8DAAY,QAAZ,CAAqB,gBAArB,EAAuC;AACnC,kBAAA,YAAY,EAAE;AADqB,iBAAvC;;AAIA,oBAAI,KAAK,QAAT,EAAmB;AACf,uBAAK,QAAL,CAAc,KAAd;AACH;;AACD,qBAAK,QAAL,GAAgB,IAAI,SAAJ,CAAc,KAAK,GAAnB,CAAhB;;AAEA,qBAAK,QAAL,CAAc,MAAd,GAAuB,YAAK;AAAA;;AACxB,kBAAA,KAAI,CAAC,UAAL,GAAkB,CAAlB;AACA,kCAAA,KAAI,CAAC,KAAL,8DAAY,QAAZ,CAAqB,eAArB,EAAsC,KAAtC;AACH,iBAHD;;AAKA,qBAAK,QAAL,CAAc,OAAd;AAAA,qFAAwB,iBAAO,CAAP;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,kCAChB,CAAC,CAAC,CAAC,QAAH,IAAe,KAAI,CAAC,UAAL,GAAkB,KAAI,CAAC,aADtB;AAAA;AAAA;AAAA;;AAEhB,4BAAA,KAAI,CAAC,UAAL;AACA,4BAAA,UAAU,CAAC,YAAK;AACZ,8BAAA,KAAI,CAAC,OAAL;AACH,6BAFS,EAEP,KAAI,CAAC,iBAFE,CAAV;AAHgB;AAAA;;AAAA;AAAA;AAAA,mDAMP,KAAI,CAAC,KANE,iDAMP,aAAY,QAAZ,CAAqB,gBAArB,EAAuC,CAAvC,CANO;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAAxB;;AAAA;AAAA;AAAA;AAAA;;AASA,qBAAK,QAAL,CAAc,OAAd,GAAwB,YAAK;AACzB,sBAAI,KAAI,CAAC,QAAT,EAAmB,KAAI,CAAC,QAAL,CAAc,KAAd;AACtB,iBAFD;;AAIA,qBAAK,QAAL,CAAc,SAAd,GAA0B,UAAC,GAAD,EAAQ;AAC9B,sBAAM,IAAI,GAAG,IAAI,CAAC,KAAL,CAAW,GAAG,CAAC,IAAf,CAAb;;AACA,sBAAI,KAAI,CAAC,KAAT,EAAgB;AAAA;;AACZ,wBAAM,IAAI,GAAG,KAAI,CAAC,WAAL,CAAiB,IAAI,CAAC,EAAtB,CAAb;;AACA,wBAAI,IAAI,IAAI,IAAI,CAAC,MAAL,KAAgB,EAA5B,EAA+B;AAAA;;AAC3B,yCAAI,IAAI,CAAC,KAAT,wCAAI,YAAY,OAAhB,EAAyB;AAAA;;AACrB,4BAAI,iBAAA,IAAI,CAAC,KAAL,8DAAY,OAAZ,MAAwB,qBAA5B,EACI,MAAM,CAAC,OAAP,CAAe,KAAf,CAAqB,qBAAmB,IAAI,CAAC,MAAxB,GAA+B,KAA/B,GAAqC,IAAI,CAAC,KAAL,CAAW,OAArE;AACP,uBAHD,MAGO,IAAI,IAAI,CAAC,MAAT,EAAiB;AAAA;;AACpB,4BAAI,MAAM,GAAG,IAAI,CAAC,MAAlB;AACA,4BAAI,MAAM,KAAK,IAAf,EAAqB,MAAM,GAAG;AAAE,0BAAA,MAAM,EAAE;AAAV,yBAAT;AACrB,4BAAI,OAAO,MAAP,KAAmB,QAAvB,EAAiC,MAAM,GAAG;AAAE,0BAAA,MAAM,EAAE;AAAV,yBAAT;AAEjC,4BAAM,OAAO,GAAG,EAAhB;AACA,4BAAI,IAAI,CAAC,aAAT,EAAwB,MAAM,CAAC,MAAP,CAAc,OAAd,EAAuB,IAAI,CAAC,aAA5B;AACxB,wBAAA,MAAM,CAAC,MAAP,CAAc,OAAd,EAAuB;AAAE,0BAAA,aAAa,EAAE,IAAI,CAAC;AAAtB,yBAAvB;AACA,wBAAA,MAAM,CAAC,MAAP,CAAc,OAAd,EAAuB,MAAvB;AACA,wCAAA,KAAI,CAAC,KAAL,8DAAY,QAAZ,CAAqB,IAAI,CAAC,MAA1B,EAAkC,OAAlC;AACH;AACJ,qBAfD,MAeO,gBAAA,KAAI,CAAC,KAAL,8DAAY,QAAZ,CAAqB,kBAArB,EAAyC,IAAzC;;AAEP,wBAAI,IAAJ,EAAU,KAAI,CAAC,cAAL,CAAoB,IAAI,CAAC,EAAzB;AACb;AACJ,iBAvBD;;AA5BJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OA7BJ;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2EAmFI;AAAA;AAAA;AAAA;AAAA;AAAA,qBACQ,KAAK,QADb;AAAA;AAAA;AAAA;;AAAA;AAAA,uBAC6B,KAAK,QAAL,CAAc,KAAd,EAD7B;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAnFJ;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA,WAuFI,qBAAY,EAAZ,EAAsB;AAAA;;AAClB,iCAAO,KAAK,KAAL,CAAW,IAAX,CAAgB,UAAC,IAAD;AAAA,eAAgB,IAAI,CAAC,EAAL,KAAY,EAA5B;AAAA,OAAhB,CAAP,+DAA0D,IAA1D;AACH;AAzFL;AAAA;AAAA,WA2FI,wBAAe,EAAf,EAAyB;AACrB,UAAM,KAAK,GAAG,KAAK,KAAL,CAAW,SAAX,CAAqB,UAAC,IAAD;AAAA,eAAgB,IAAI,CAAC,EAAL,KAAY,EAA5B;AAAA,OAArB,CAAd;;AACA,UAAI,KAAJ,EAAW;AACP,YAAM,IAAI,GAAG,KAAK,KAAL,CAAW,KAAX,CAAb;;AACA,YAAI,IAAI,CAAC,OAAL,IAAgB,KAAK,KAAzB,EAAgC;AAC5B,eAAK,KAAL,CAAW,QAAX,CAAoB,sBAApB,EAA4C;AAAE,YAAA,IAAI,EAAE,IAAI,CAAC;AAAb,WAA5C;AACH;;AACD,aAAK,KAAL,CAAW,MAAX,CAAkB,KAAlB,EAAyB,CAAzB;AACH;AACJ;AApGL;AAAA;AAAA,WAsGI,cAAK,MAAL,EAAqB,MAArB,EAA8D;AAAA;;AAAA,UAAzB,OAAyB,uEAAF,EAAE;;AAC1D,UAAI,wBAAK,QAAL,kEAAe,UAAf,MAA8B,SAAS,CAAC,IAA5C,EAAkD;AAAA;;AAC9C,YAAM,EAAE,GAAG,IAAI,CAAC,KAAL,CAAW,IAAI,CAAC,MAAL,KAAgB,KAA3B,IAAoC,CAA/C;AACA,aAAK,KAAL,CAAW,IAAX,CAAgB;AACZ,UAAA,EAAE,EAAE,EADQ;AAEZ,UAAA,MAAM,EAAE,MAFI;AAGZ,UAAA,MAAM,qBAAE,OAAO,CAAC,MAAV,6DAAoB,IAHd;AAIZ,UAAA,aAAa,2BAAE,OAAO,CAAC,aAAV,yEAA2B,EAJ5B;AAKZ,UAAA,OAAO,sBAAE,OAAO,CAAC,OAAV,+DAAqB;AALhB,SAAhB;;AAQA,YAAI,OAAO,CAAC,OAAR,IAAmB,KAAK,KAA5B,EAAmC;AAC/B,eAAK,KAAL,CAAW,QAAX,CAAoB,mBAApB,EAAyC;AAAE,YAAA,IAAI,EAAE,OAAO,CAAC;AAAhB,WAAzC;AACH;;AAED,YAAM,GAAG,GAAG,IAAI,CAAC,SAAL,CAAe;AACvB,UAAA,OAAO,EAAE,KADc;AAEvB,UAAA,MAAM,EAAE,MAFe;AAGvB,UAAA,MAAM,EAAE,MAHe;AAIvB,UAAA,EAAE,EAAE;AAJmB,SAAf,CAAZ;AAOA,aAAK,QAAL,CAAc,IAAd,CAAmB,GAAnB;AACH;AACJ;AA9HL;;AAAA;AAAA;AAiIA,OAAM,SAAU,eAAV,CAA0B,GAA1B,EAA4C,OAA5C,EAA2E;AAC7E,MAAM,MAAM,GAAG,IAAI,eAAJ,CAAoB,OAApB,CAAf;AACA,EAAA,GAAG,CAAC,SAAJ,CAAc,OAAd,GAAwB,MAAxB;AACA,EAAA,GAAG,CAAC,OAAJ,GAAc,MAAd;AACH","sourcesContent":["import {Store} from 'vuex'\nimport _Vue from 'vue'\nimport {RootState} from '@/store/types'\n\nexport class WebSocketClient {\n    url = ''\n    instance: WebSocket | null = null\n    maxReconnects  = 5\n    reconnectInterval = 1000\n    reconnects = 0\n    keepAliveTimeout = 1000\n    timerId: number | null = null\n    store: Store<RootState> | null = null\n    waits: Wait[] = []\n\n    constructor (options: WebSocketPluginOptions) {\n        this.url = options.url\n        this.maxReconnects = options.maxReconnects || 5\n        this.reconnectInterval = options.reconnectInterval || 1000\n        this.store = options.store\n    }\n\n    setUrl(url: string): void {\n        this.url = url\n    }\n\n    // eslint-disable-next-line\n    passToStore (eventName: string, event: any): void {\n        if (!eventName.startsWith('socket/')) { return }\n\n        this.store?.dispatch(eventName, event)\n    }\n\n    async connect() {\n        this.store?.dispatch('socket/setData', {\n            isConnecting: true\n        })\n\n        if (this.instance) {\n            this.instance.close()\n        }\n        this.instance = new WebSocket(this.url)\n\n        this.instance.onopen = () => {\n            this.reconnects = 0\n            this.store?.dispatch('socket/onOpen', event)\n        }\n\n        this.instance.onclose = async (e) => {\n            if (!e.wasClean && this.reconnects < this.maxReconnects) {\n                this.reconnects++\n                setTimeout(() => {\n                    this.connect()\n                }, this.reconnectInterval)\n            } else await this.store?.dispatch('socket/onClose', e)\n        }\n\n        this.instance.onerror = () => {\n            if (this.instance) this.instance.close()\n        }\n\n        this.instance.onmessage = (msg) => {\n            const data = JSON.parse(msg.data)\n            if (this.store) {\n                const wait = this.getWaitById(data.id)\n                if (wait && wait.action !== ''){\n                    if (data.error?.message) {\n                        if (data.error?.message !== 'Klippy Disconnected')\n                            window.console.error('Response Error: '+wait.action+' > '+data.error.message)\n                    } else if (wait.action) {\n                        let result = data.result\n                        if (result === 'ok') result = { result: result }\n                        if (typeof(result) === 'string') result = { result: result }\n\n                        const preload = {}\n                        if (wait.actionPayload) Object.assign(preload, wait.actionPayload)\n                        Object.assign(preload, { requestParams: wait.params })\n                        Object.assign(preload, result)\n                        this.store?.dispatch(wait.action, preload)\n                    }\n                } else this.store?.dispatch('socket/onMessage', data)\n\n                if (wait) this.removeWaitById(wait.id)\n            }\n        }\n    }\n\n    async close() {\n        if (this.instance) await this.instance.close()\n    }\n\n    getWaitById(id: number): Wait | null {\n        return this.waits.find((wait: Wait) => wait.id === id) ?? null\n    }\n\n    removeWaitById(id: number): void {\n        const index = this.waits.findIndex((wait: Wait) => wait.id === id)\n        if (index) {\n            const wait = this.waits[index]\n            if (wait.loading && this.store) {\n                this.store.dispatch('socket/removeLoading', { name: wait.loading })\n            }\n            this.waits.splice(index, 1)\n        }\n    }\n\n    emit(method: string, params: Params, options: emitOptions = {}):void {\n        if (this.instance?.readyState === WebSocket.OPEN) {\n            const id = Math.floor(Math.random() * 10000) + 1\n            this.waits.push({\n                id: id,\n                params: params,\n                action: options.action ?? null,\n                actionPayload: options.actionPayload ?? {},\n                loading: options.loading ?? null,\n            })\n\n            if (options.loading && this.store) {\n                this.store.dispatch('socket/addLoading', { name: options.loading })\n            }\n\n            const msg = JSON.stringify({\n                jsonrpc: '2.0',\n                method: method,\n                params: params,\n                id: id\n            })\n\n            this.instance.send(msg)\n        }\n    }\n}\n\nexport function WebSocketPlugin(Vue: typeof _Vue, options: WebSocketPluginOptions): void {\n    const socket = new WebSocketClient(options)\n    Vue.prototype.$socket = socket\n    Vue.$socket = socket\n}\n\nexport interface WebSocketPluginOptions {\n    url: string\n    maxReconnects?: number\n    reconnectInterval?: number\n    store: Store<RootState>\n}\n\nexport interface WebSocketClient {\n    connect(): void\n    close(): void\n    emit(method: string, params: Params, emitOptions: emitOptions):void\n}\n\nexport interface Wait {\n    id: number\n    params: any\n    action?: string | null\n    actionPayload?: any\n    loading?: string | null\n}\n\ninterface Params {\n    data?: any\n    [key: string]: any\n}\n\ninterface emitOptions {\n    action?: string | null\n    actionPayload?: Params\n    loading?: string | null\n}\n"],"sourceRoot":""}]}