{"remainingRequest":"/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/node_modules/thread-loader/dist/cjs.js!/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/node_modules/babel-loader/lib/index.js!/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/node_modules/ts-loader/index.js??ref--15-3!/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/node_modules/@vue/cli-plugin-eslint/node_modules/eslint-loader/index.js??ref--14-0!/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/src/store/printer/getters.ts","dependencies":[{"path":"/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/src/store/printer/getters.ts","mtime":1646087446493},{"path":"/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/node_modules/cache-loader/dist/cjs.js","mtime":1645990064605},{"path":"/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/node_modules/thread-loader/dist/cjs.js","mtime":1645990064416},{"path":"/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/node_modules/babel-loader/lib/index.js","mtime":1645990067759},{"path":"/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/node_modules/ts-loader/index.js","mtime":1645990068168},{"path":"/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/node_modules/@vue/cli-plugin-eslint/node_modules/eslint-loader/index.js","mtime":1645990065243}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF90b0NvbnN1bWFibGVBcnJheSBmcm9tICIvVXNlcnMvYW5uZS1zb3BoaWVyb3kvRG93bmxvYWRzL01haW5zYWlsL21haW5zYWlsLW1haW50ZW5hbmNlL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS90b0NvbnN1bWFibGVBcnJheS5qcyI7CmltcG9ydCBfc2xpY2VkVG9BcnJheSBmcm9tICIvVXNlcnMvYW5uZS1zb3BoaWVyb3kvRG93bmxvYWRzL01haW5zYWlsL21haW5zYWlsLW1haW50ZW5hbmNlL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9zbGljZWRUb0FycmF5LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMubnVtYmVyLnRvLWZpeGVkLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmtleXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5mb3ItZWFjaC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zdGFydHMtd2l0aC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC5leGVjLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnJlcGxhY2UuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zeW1ib2wuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zeW1ib2wuZGVzY3JpcHRpb24uanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuZW50cmllcy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmluY2x1ZGVzLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLmluY2x1ZGVzLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnNwbGl0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc29ydC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmZ1bmN0aW9uLm5hbWUuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5qb2luLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc2xpY2UuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5maW5kLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZC1pbmRleC5qcyI7CmltcG9ydCB7IGFkZGl0aW9uYWxTZW5zb3JzLCBjaGVja0tsaXBwZXJDb25maWdNb2R1bGVzIH0gZnJvbSAnQC9zdG9yZS92YXJpYWJsZXMnOwppbXBvcnQgeyBjYXNlSW5zZW5zaXRpdmVTb3J0LCBmb3JtYXRGcmVxdWVuY3ksIGdldE1hY3JvUGFyYW1zIH0gZnJvbSAnQC9wbHVnaW5zL2hlbHBlcnMnOwpleHBvcnQgdmFyIGdldHRlcnMgPSB7CiAgZ2V0UHJpbnRQZXJjZW50OiBmdW5jdGlvbiBnZXRQcmludFBlcmNlbnQoc3RhdGUpIHsKICAgIHZhciBfc3RhdGUkY3VycmVudF9maWxlLCBfc3RhdGUkY3VycmVudF9maWxlMiwgX3N0YXRlJGN1cnJlbnRfZmlsZTMsIF9zdGF0ZSR2aXJ0dWFsX3NkY2FyZCwgX3N0YXRlJHZpcnR1YWxfc2RjYXJkMjsKCiAgICBpZiAoKF9zdGF0ZSRjdXJyZW50X2ZpbGUgPSBzdGF0ZS5jdXJyZW50X2ZpbGUpICE9PSBudWxsICYmIF9zdGF0ZSRjdXJyZW50X2ZpbGUgIT09IHZvaWQgMCAmJiBfc3RhdGUkY3VycmVudF9maWxlLmZpbGVuYW1lICYmIChfc3RhdGUkY3VycmVudF9maWxlMiA9IHN0YXRlLmN1cnJlbnRfZmlsZSkgIT09IG51bGwgJiYgX3N0YXRlJGN1cnJlbnRfZmlsZTIgIT09IHZvaWQgMCAmJiBfc3RhdGUkY3VycmVudF9maWxlMi5nY29kZV9zdGFydF9ieXRlICYmIChfc3RhdGUkY3VycmVudF9maWxlMyA9IHN0YXRlLmN1cnJlbnRfZmlsZSkgIT09IG51bGwgJiYgX3N0YXRlJGN1cnJlbnRfZmlsZTMgIT09IHZvaWQgMCAmJiBfc3RhdGUkY3VycmVudF9maWxlMy5nY29kZV9lbmRfYnl0ZSAmJiBzdGF0ZS5jdXJyZW50X2ZpbGUuZmlsZW5hbWUgPT09IHN0YXRlLnByaW50X3N0YXRzLmZpbGVuYW1lKSB7CiAgICAgIGlmIChzdGF0ZS52aXJ0dWFsX3NkY2FyZC5maWxlX3Bvc2l0aW9uIDw9IHN0YXRlLmN1cnJlbnRfZmlsZS5nY29kZV9zdGFydF9ieXRlKSByZXR1cm4gMDsKICAgICAgaWYgKHN0YXRlLnZpcnR1YWxfc2RjYXJkLmZpbGVfcG9zaXRpb24gPj0gc3RhdGUuY3VycmVudF9maWxlLmdjb2RlX2VuZF9ieXRlKSByZXR1cm4gMTsKICAgICAgdmFyIGN1cnJlbnRQb3NpdGlvbiA9IHN0YXRlLnZpcnR1YWxfc2RjYXJkLmZpbGVfcG9zaXRpb24gLSBzdGF0ZS5jdXJyZW50X2ZpbGUuZ2NvZGVfc3RhcnRfYnl0ZTsKICAgICAgdmFyIG1heFBvc2l0aW9uID0gc3RhdGUuY3VycmVudF9maWxlLmdjb2RlX2VuZF9ieXRlIC0gc3RhdGUuY3VycmVudF9maWxlLmdjb2RlX3N0YXJ0X2J5dGU7CiAgICAgIGlmIChjdXJyZW50UG9zaXRpb24gPiAwICYmIG1heFBvc2l0aW9uID4gMCkgcmV0dXJuIDEgLyBtYXhQb3NpdGlvbiAqIGN1cnJlbnRQb3NpdGlvbjsKICAgIH0KCiAgICByZXR1cm4gKF9zdGF0ZSR2aXJ0dWFsX3NkY2FyZCA9IChfc3RhdGUkdmlydHVhbF9zZGNhcmQyID0gc3RhdGUudmlydHVhbF9zZGNhcmQpID09PSBudWxsIHx8IF9zdGF0ZSR2aXJ0dWFsX3NkY2FyZDIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9zdGF0ZSR2aXJ0dWFsX3NkY2FyZDIucHJvZ3Jlc3MpICE9PSBudWxsICYmIF9zdGF0ZSR2aXJ0dWFsX3NkY2FyZCAhPT0gdm9pZCAwID8gX3N0YXRlJHZpcnR1YWxfc2RjYXJkIDogMDsKICB9LAogIGdldFBvc2l0aW9uczogZnVuY3Rpb24gZ2V0UG9zaXRpb25zKHN0YXRlKSB7CiAgICB2YXIgX3JlZiwgX3N0YXRlJG1vdGlvbl9yZXBvcnQkLCBfc3RhdGUkbW90aW9uX3JlcG9ydCwgX3N0YXRlJHRvb2xoZWFkLCBfc3RhdGUkZ2NvZGVfbW92ZSRnY28sIF9zdGF0ZSRnY29kZV9tb3ZlLCBfc3RhdGUkZ2NvZGVfbW92ZSRhYnMsIF9zdGF0ZSRnY29kZV9tb3ZlMiwgX3Bvc2l0aW9uJDAkdG9GaXhlZCwgX3Bvc2l0aW9uJCwgX3Bvc2l0aW9uJDEkdG9GaXhlZCwgX3Bvc2l0aW9uJDIsIF9wb3NpdGlvbiQyJHRvRml4ZWQsIF9wb3NpdGlvbiQzLCBfZ2NvZGVfcG9zaXRpb24kMiR0b0YsIF9nY29kZV9wb3NpdGlvbiQ7CgogICAgdmFyIHBvc2l0aW9uID0gKF9yZWYgPSAoX3N0YXRlJG1vdGlvbl9yZXBvcnQkID0gKF9zdGF0ZSRtb3Rpb25fcmVwb3J0ID0gc3RhdGUubW90aW9uX3JlcG9ydCkgPT09IG51bGwgfHwgX3N0YXRlJG1vdGlvbl9yZXBvcnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9zdGF0ZSRtb3Rpb25fcmVwb3J0LmxpdmVfcG9zaXRpb24pICE9PSBudWxsICYmIF9zdGF0ZSRtb3Rpb25fcmVwb3J0JCAhPT0gdm9pZCAwID8gX3N0YXRlJG1vdGlvbl9yZXBvcnQkIDogKF9zdGF0ZSR0b29saGVhZCA9IHN0YXRlLnRvb2xoZWFkKSA9PT0gbnVsbCB8fCBfc3RhdGUkdG9vbGhlYWQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9zdGF0ZSR0b29saGVhZC5wb3NpdGlvbikgIT09IG51bGwgJiYgX3JlZiAhPT0gdm9pZCAwID8gX3JlZiA6IFswLCAwLCAwXTsKICAgIHZhciBnY29kZV9wb3NpdGlvbiA9IChfc3RhdGUkZ2NvZGVfbW92ZSRnY28gPSAoX3N0YXRlJGdjb2RlX21vdmUgPSBzdGF0ZS5nY29kZV9tb3ZlKSA9PT0gbnVsbCB8fCBfc3RhdGUkZ2NvZGVfbW92ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3N0YXRlJGdjb2RlX21vdmUuZ2NvZGVfcG9zaXRpb24pICE9PSBudWxsICYmIF9zdGF0ZSRnY29kZV9tb3ZlJGdjbyAhPT0gdm9pZCAwID8gX3N0YXRlJGdjb2RlX21vdmUkZ2NvIDogWzAsIDAsIDBdOwogICAgdmFyIGFic29sdXRlID0gKF9zdGF0ZSRnY29kZV9tb3ZlJGFicyA9IChfc3RhdGUkZ2NvZGVfbW92ZTIgPSBzdGF0ZS5nY29kZV9tb3ZlKSA9PT0gbnVsbCB8fCBfc3RhdGUkZ2NvZGVfbW92ZTIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9zdGF0ZSRnY29kZV9tb3ZlMi5hYnNvbHV0ZV9jb29yZGluYXRlcykgIT09IG51bGwgJiYgX3N0YXRlJGdjb2RlX21vdmUkYWJzICE9PSB2b2lkIDAgPyBfc3RhdGUkZ2NvZGVfbW92ZSRhYnMgOiB0cnVlOwogICAgcmV0dXJuIHsKICAgICAgY29vcmRpbmF0ZXM6IGFic29sdXRlLAogICAgICB4OiAoX3Bvc2l0aW9uJDAkdG9GaXhlZCA9IChfcG9zaXRpb24kID0gcG9zaXRpb25bMF0pID09PSBudWxsIHx8IF9wb3NpdGlvbiQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9wb3NpdGlvbiQudG9GaXhlZCgyKSkgIT09IG51bGwgJiYgX3Bvc2l0aW9uJDAkdG9GaXhlZCAhPT0gdm9pZCAwID8gX3Bvc2l0aW9uJDAkdG9GaXhlZCA6ICctLScsCiAgICAgIHk6IChfcG9zaXRpb24kMSR0b0ZpeGVkID0gKF9wb3NpdGlvbiQyID0gcG9zaXRpb25bMV0pID09PSBudWxsIHx8IF9wb3NpdGlvbiQyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfcG9zaXRpb24kMi50b0ZpeGVkKDIpKSAhPT0gbnVsbCAmJiBfcG9zaXRpb24kMSR0b0ZpeGVkICE9PSB2b2lkIDAgPyBfcG9zaXRpb24kMSR0b0ZpeGVkIDogJy0tJywKICAgICAgejogKF9wb3NpdGlvbiQyJHRvRml4ZWQgPSAoX3Bvc2l0aW9uJDMgPSBwb3NpdGlvblsyXSkgPT09IG51bGwgfHwgX3Bvc2l0aW9uJDMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9wb3NpdGlvbiQzLnRvRml4ZWQoMikpICE9PSBudWxsICYmIF9wb3NpdGlvbiQyJHRvRml4ZWQgIT09IHZvaWQgMCA/IF9wb3NpdGlvbiQyJHRvRml4ZWQgOiAnLS0nLAogICAgICBnY29kZV96OiAoX2djb2RlX3Bvc2l0aW9uJDIkdG9GID0gKF9nY29kZV9wb3NpdGlvbiQgPSBnY29kZV9wb3NpdGlvblsyXSkgPT09IG51bGwgfHwgX2djb2RlX3Bvc2l0aW9uJCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2djb2RlX3Bvc2l0aW9uJC50b0ZpeGVkKDIpKSAhPT0gbnVsbCAmJiBfZ2NvZGVfcG9zaXRpb24kMiR0b0YgIT09IHZvaWQgMCA/IF9nY29kZV9wb3NpdGlvbiQyJHRvRiA6ICctLScKICAgIH07CiAgfSwKICBnZXRGaWNoaWVyczogZnVuY3Rpb24gZ2V0RmljaGllcnMoc3RhdGUsIGdldHRlcnMsIHJvb3RTdGF0ZSkgewogICAgdmFyIF9zdGF0ZSRjb25maWdmaWxlOwoKICAgIHJldHVybiBTdHJpbmcoT2JqZWN0LmtleXMoKF9zdGF0ZSRjb25maWdmaWxlID0gc3RhdGUuY29uZmlnZmlsZSkgPT09IG51bGwgfHwgX3N0YXRlJGNvbmZpZ2ZpbGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9zdGF0ZSRjb25maWdmaWxlLmNvbmZpZykpOwogIH0sCiAgZ2V0TWFjcm9zOiBmdW5jdGlvbiBnZXRNYWNyb3Moc3RhdGUsIGdldHRlcnMsIHJvb3RTdGF0ZSkgewogICAgdmFyIF9yb290U3RhdGUkZ3VpLCBfcm9vdFN0YXRlJGd1aSRtYWNyb3MsIF9zdGF0ZSRjb25maWdmaWxlMjsKCiAgICB2YXIgYXJyYXkgPSBbXTsKICAgIHZhciBoaWRkZW5NYWNyb3MgPSBbXTsKICAgIChfcm9vdFN0YXRlJGd1aSA9IHJvb3RTdGF0ZS5ndWkpID09PSBudWxsIHx8IF9yb290U3RhdGUkZ3VpID09PSB2b2lkIDAgPyB2b2lkIDAgOiAoX3Jvb3RTdGF0ZSRndWkkbWFjcm9zID0gX3Jvb3RTdGF0ZSRndWkubWFjcm9zKSA9PT0gbnVsbCB8fCBfcm9vdFN0YXRlJGd1aSRtYWNyb3MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9yb290U3RhdGUkZ3VpJG1hY3Jvcy5oaWRkZW5NYWNyb3MuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSwgaW5kZXgpIHsKICAgICAgaGlkZGVuTWFjcm9zW2luZGV4XSA9IGl0ZW0udG9Mb3dlckNhc2UoKTsKICAgIH0pOwoKICAgIGlmICgoX3N0YXRlJGNvbmZpZ2ZpbGUyID0gc3RhdGUuY29uZmlnZmlsZSkgIT09IG51bGwgJiYgX3N0YXRlJGNvbmZpZ2ZpbGUyICE9PSB2b2lkIDAgJiYgX3N0YXRlJGNvbmZpZ2ZpbGUyLmNvbmZpZykgewogICAgICB2YXIgX3N0YXRlJGNvbmZpZ2ZpbGUzOwoKICAgICAgT2JqZWN0LmtleXMoKF9zdGF0ZSRjb25maWdmaWxlMyA9IHN0YXRlLmNvbmZpZ2ZpbGUpID09PSBudWxsIHx8IF9zdGF0ZSRjb25maWdmaWxlMyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3N0YXRlJGNvbmZpZ2ZpbGUzLmNvbmZpZykuZm9yRWFjaChmdW5jdGlvbiAocHJvcCkgewogICAgICAgIGlmIChwcm9wLnN0YXJ0c1dpdGgoJ2djb2RlX21hY3JvJykgJiYgIXByb3Auc3RhcnRzV2l0aCgnZ2NvZGVfbWFjcm8gXycpICYmICEoJ3JlbmFtZV9leGlzdGluZycgaW4gc3RhdGUuY29uZmlnZmlsZS5jb25maWdbcHJvcF0pICYmICEoaGlkZGVuTWFjcm9zLmluZGV4T2YocHJvcC5yZXBsYWNlKCdnY29kZV9tYWNybyAnLCAnJykudG9Mb3dlckNhc2UoKSkgPiAtMSkpIHsKICAgICAgICAgIHZhciBfc3RhdGUkY29uZmlnZmlsZSRjb247CgogICAgICAgICAgYXJyYXkucHVzaCh7CiAgICAgICAgICAgICduYW1lJzogcHJvcC5yZXBsYWNlKCdnY29kZV9tYWNybyAnLCAnJyksCiAgICAgICAgICAgICdkZXNjcmlwdGlvbic6IChfc3RhdGUkY29uZmlnZmlsZSRjb24gPSBzdGF0ZS5jb25maWdmaWxlLmNvbmZpZ1twcm9wXS5kZXNjcmlwdGlvbikgIT09IG51bGwgJiYgX3N0YXRlJGNvbmZpZ2ZpbGUkY29uICE9PSB2b2lkIDAgPyBfc3RhdGUkY29uZmlnZmlsZSRjb24gOiBudWxsLAogICAgICAgICAgICAncHJvcCc6IHN0YXRlLmNvbmZpZ2ZpbGUuY29uZmlnW3Byb3BdLAogICAgICAgICAgICAncGFyYW1zJzogZ2V0TWFjcm9QYXJhbXMoc3RhdGUuY29uZmlnZmlsZS5jb25maWdbcHJvcF0pCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQoKICAgIHJldHVybiBjYXNlSW5zZW5zaXRpdmVTb3J0KGFycmF5LCAnbmFtZScpOwogIH0sCiAgZ2V0SGVhdGVyczogZnVuY3Rpb24gZ2V0SGVhdGVycyhzdGF0ZSwgZ2V0dGVycywgcm9vdFN0YXRlLCByb290R2V0dGVycykgewogICAgdmFyIF9zdGF0ZSRoZWF0ZXJzOwoKICAgIHZhciBoZWF0ZXJzID0gW107CiAgICB2YXIgY29sb3JPZmYgPSAnZ3JleSBkYXJrZW4tMic7CiAgICB2YXIgY29sb3JIb3QgPSAnZ3JleSBsaWdodGVuLTUnOwoKICAgIGlmICgoX3N0YXRlJGhlYXRlcnMgPSBzdGF0ZS5oZWF0ZXJzKSAhPT0gbnVsbCAmJiBfc3RhdGUkaGVhdGVycyAhPT0gdm9pZCAwICYmIF9zdGF0ZSRoZWF0ZXJzLmF2YWlsYWJsZV9oZWF0ZXJzKSB7CiAgICAgIGZvciAodmFyIF9pID0gMCwgX09iamVjdCRlbnRyaWVzID0gT2JqZWN0LmVudHJpZXMoc3RhdGUpOyBfaSA8IF9PYmplY3QkZW50cmllcy5sZW5ndGg7IF9pKyspIHsKICAgICAgICB2YXIgX09iamVjdCRlbnRyaWVzJF9pID0gX3NsaWNlZFRvQXJyYXkoX09iamVjdCRlbnRyaWVzW19pXSwgMiksCiAgICAgICAgICAgIGtleSA9IF9PYmplY3QkZW50cmllcyRfaVswXSwKICAgICAgICAgICAgdmFsdWUgPSBfT2JqZWN0JGVudHJpZXMkX2lbMV07CgogICAgICAgIGlmIChzdGF0ZS5oZWF0ZXJzLmF2YWlsYWJsZV9oZWF0ZXJzLmluY2x1ZGVzKGtleSkpIHsKICAgICAgICAgIHZhciBfbmFtZSA9IGtleTsKICAgICAgICAgIHZhciBuYW1lU3BsaXQgPSBrZXkuc3BsaXQoJyAnKTsKICAgICAgICAgIGlmIChuYW1lU3BsaXQubGVuZ3RoID4gMSAmJiBuYW1lU3BsaXRbMF0gPT09ICdoZWF0ZXJfZ2VuZXJpYycpIF9uYW1lID0gbmFtZVNwbGl0WzFdOwogICAgICAgICAgdmFyIGljb24gPSAncHJpbnRlci0zZC1ub3p6bGUtYWxlcnQnOwogICAgICAgICAgdmFyIGNvbG9yID0gY29sb3JPZmY7CiAgICAgICAgICBpZiAodmFsdWUudGFyZ2V0KSBjb2xvciA9IGNvbG9ySG90OwoKICAgICAgICAgIGlmIChuYW1lU3BsaXRbMF0uc3RhcnRzV2l0aCgnZXh0cnVkZXInKSkgewogICAgICAgICAgICB2YXIgbWluX2V4dHJ1ZGVfdGVtcCA9IGtleSBpbiBzdGF0ZS5jb25maWdmaWxlLmNvbmZpZyAmJiAnbWluX2V4dHJ1ZGVfdGVtcCcgaW4gc3RhdGUuY29uZmlnZmlsZS5jb25maWdba2V5XSA/IHBhcnNlRmxvYXQoc3RhdGUuY29uZmlnZmlsZS5jb25maWdba2V5XS5taW5fZXh0cnVkZV90ZW1wKSA6IDE3MDsKICAgICAgICAgICAgaWYgKHZhbHVlLnRlbXBlcmF0dXJlID49IG1pbl9leHRydWRlX3RlbXApIGljb24gPSAncHJpbnRlci0zZC1ub3p6bGUnOwogICAgICAgICAgfSBlbHNlIGlmIChuYW1lU3BsaXRbMF0gPT09ICdoZWF0ZXJfYmVkJykgewogICAgICAgICAgICBpY29uID0gJ3JhZGlhdG9yLWRpc2FibGVkJzsKICAgICAgICAgICAgaWYgKHZhbHVlLnRlbXBlcmF0dXJlID4gNTAgfHwgdmFsdWUudGFyZ2V0ICYmIHZhbHVlLnRlbXBlcmF0dXJlID4gdmFsdWUudGFyZ2V0IC0gNSkgaWNvbiA9ICdyYWRpYXRvcic7CiAgICAgICAgICB9IGVsc2UgaWYgKG5hbWVTcGxpdFswXS5zdGFydHNXaXRoKCdoZWF0ZXJfZ2VuZXJpYycpKSBpY29uID0gJ2ZpcmUnOwoKICAgICAgICAgIGlmICghX25hbWUuc3RhcnRzV2l0aCgnXycpKSB7CiAgICAgICAgICAgIHZhciBfdmFsdWUkcG93ZXIsIF9nZXR0ZXJzJHRlbXBIaXN0b3J5LCBfc3RhdGUkY29uZmlnZmlsZSRjb24yLCBfc3RhdGUkY29uZmlnZmlsZTQsIF9zdGF0ZSRjb25maWdmaWxlNCRjbywgX3N0YXRlJGNvbmZpZ2ZpbGUkY29uMywgX3N0YXRlJGNvbmZpZ2ZpbGU1LCBfc3RhdGUkY29uZmlnZmlsZTUkY287CgogICAgICAgICAgICBoZWF0ZXJzLnB1c2goewogICAgICAgICAgICAgIG5hbWU6IF9uYW1lLAogICAgICAgICAgICAgIHR5cGU6IG5hbWVTcGxpdFswXSwKICAgICAgICAgICAgICBpY29uOiBpY29uLAogICAgICAgICAgICAgIGljb25Db2xvcjogY29sb3IsCiAgICAgICAgICAgICAgdGFyZ2V0OiBNYXRoLnJvdW5kKHZhbHVlLnRhcmdldCAqIDEwKSAvIDEwLAogICAgICAgICAgICAgIHRlbXBlcmF0dXJlOiBNYXRoLnJvdW5kKHZhbHVlLnRlbXBlcmF0dXJlICogMTApIC8gMTAsCiAgICAgICAgICAgICAgYWRkaXRpb25TZW5zb3JzOiBnZXR0ZXJzLmdldEFkZGl0aW9uU2Vuc29ycyhuYW1lU3BsaXRbMV0pLAogICAgICAgICAgICAgIHBvd2VyOiBNYXRoLnJvdW5kKCgoX3ZhbHVlJHBvd2VyID0gdmFsdWUucG93ZXIpICE9PSBudWxsICYmIF92YWx1ZSRwb3dlciAhPT0gdm9pZCAwID8gX3ZhbHVlJHBvd2VyIDogMCkgKiAxMDApLAogICAgICAgICAgICAgIGF2Z1Bvd2VyOiBNYXRoLnJvdW5kKChfZ2V0dGVycyR0ZW1wSGlzdG9yeSA9IGdldHRlcnNbJ3RlbXBIaXN0b3J5L2dldEF2Z1Bvd2VyJ10oX25hbWUpKSAhPT0gbnVsbCAmJiBfZ2V0dGVycyR0ZW1wSGlzdG9yeSAhPT0gdm9pZCAwID8gX2dldHRlcnMkdGVtcEhpc3RvcnkgOiAwKSwKICAgICAgICAgICAgICBwcmVzZXRzOiByb290R2V0dGVyc1snZ3VpL3ByZXNldHMvZ2V0UHJlc2V0c0Zyb21IZWF0ZXInXSh7CiAgICAgICAgICAgICAgICBuYW1lOiBrZXkKICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICBjaGFydENvbG9yOiBnZXR0ZXJzWyd0ZW1wSGlzdG9yeS9nZXREYXRhc2V0Q29sb3InXShfbmFtZSksCiAgICAgICAgICAgICAgY2hhcnRTZXJpZXM6IGdldHRlcnNbJ3RlbXBIaXN0b3J5L2dldFNlcmllTmFtZXMnXShfbmFtZSksCiAgICAgICAgICAgICAgbWluX3RlbXA6IHBhcnNlSW50KChfc3RhdGUkY29uZmlnZmlsZSRjb24yID0gKF9zdGF0ZSRjb25maWdmaWxlNCA9IHN0YXRlLmNvbmZpZ2ZpbGUpID09PSBudWxsIHx8IF9zdGF0ZSRjb25maWdmaWxlNCA9PT0gdm9pZCAwID8gdm9pZCAwIDogKF9zdGF0ZSRjb25maWdmaWxlNCRjbyA9IF9zdGF0ZSRjb25maWdmaWxlNC5jb25maWdba2V5XSkgPT09IG51bGwgfHwgX3N0YXRlJGNvbmZpZ2ZpbGU0JGNvID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfc3RhdGUkY29uZmlnZmlsZTQkY28ubWluX3RlbXApICE9PSBudWxsICYmIF9zdGF0ZSRjb25maWdmaWxlJGNvbjIgIT09IHZvaWQgMCA/IF9zdGF0ZSRjb25maWdmaWxlJGNvbjIgOiAwKSwKICAgICAgICAgICAgICBtYXhfdGVtcDogcGFyc2VJbnQoKF9zdGF0ZSRjb25maWdmaWxlJGNvbjMgPSAoX3N0YXRlJGNvbmZpZ2ZpbGU1ID0gc3RhdGUuY29uZmlnZmlsZSkgPT09IG51bGwgfHwgX3N0YXRlJGNvbmZpZ2ZpbGU1ID09PSB2b2lkIDAgPyB2b2lkIDAgOiAoX3N0YXRlJGNvbmZpZ2ZpbGU1JGNvID0gX3N0YXRlJGNvbmZpZ2ZpbGU1LmNvbmZpZ1trZXldKSA9PT0gbnVsbCB8fCBfc3RhdGUkY29uZmlnZmlsZTUkY28gPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9zdGF0ZSRjb25maWdmaWxlNSRjby5tYXhfdGVtcCkgIT09IG51bGwgJiYgX3N0YXRlJGNvbmZpZ2ZpbGUkY29uMyAhPT0gdm9pZCAwID8gX3N0YXRlJGNvbmZpZ2ZpbGUkY29uMyA6IDApCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHJldHVybiBjYXNlSW5zZW5zaXRpdmVTb3J0KGhlYXRlcnMsICduYW1lJyk7CiAgfSwKICBnZXRUZW1wZXJhdHVyZUZhbnM6IGZ1bmN0aW9uIGdldFRlbXBlcmF0dXJlRmFucyhzdGF0ZSwgZ2V0dGVycywgcm9vdFN0YXRlLCByb290R2V0dGVycykgewogICAgdmFyIGZhbnMgPSBbXTsKCiAgICBmb3IgKHZhciBfaTIgPSAwLCBfT2JqZWN0JGVudHJpZXMyID0gT2JqZWN0LmVudHJpZXMoc3RhdGUpOyBfaTIgPCBfT2JqZWN0JGVudHJpZXMyLmxlbmd0aDsgX2kyKyspIHsKICAgICAgdmFyIF9PYmplY3QkZW50cmllczIkX2kgPSBfc2xpY2VkVG9BcnJheShfT2JqZWN0JGVudHJpZXMyW19pMl0sIDIpLAogICAgICAgICAga2V5ID0gX09iamVjdCRlbnRyaWVzMiRfaVswXSwKICAgICAgICAgIHZhbHVlID0gX09iamVjdCRlbnRyaWVzMiRfaVsxXTsKCiAgICAgIHZhciBuYW1lU3BsaXQgPSBrZXkuc3BsaXQoJyAnKTsKCiAgICAgIGlmIChuYW1lU3BsaXRbMF0gPT09ICd0ZW1wZXJhdHVyZV9mYW4nICYmICFuYW1lU3BsaXRbMV0uc3RhcnRzV2l0aCgnXycpKSB7CiAgICAgICAgdmFyIF92YWx1ZSRzcGVlZCwgX2dldHRlcnMkdGVtcEhpc3RvcnkyLCBfc3RhdGUkY29uZmlnZmlsZSRjb240LCBfc3RhdGUkY29uZmlnZmlsZTYsIF9zdGF0ZSRjb25maWdmaWxlNiRjbywgX3N0YXRlJGNvbmZpZ2ZpbGUkY29uNSwgX3N0YXRlJGNvbmZpZ2ZpbGU3LCBfc3RhdGUkY29uZmlnZmlsZTckY287CgogICAgICAgIGZhbnMucHVzaCh7CiAgICAgICAgICBuYW1lOiBuYW1lU3BsaXRbMV0sCiAgICAgICAgICBpY29uOiAnZmFuJywKICAgICAgICAgIHRhcmdldDogTWF0aC5yb3VuZCh2YWx1ZS50YXJnZXQgKiAxMCkgLyAxMCwKICAgICAgICAgIHRlbXBlcmF0dXJlOiBNYXRoLnJvdW5kKHZhbHVlLnRlbXBlcmF0dXJlICogMTApIC8gMTAsCiAgICAgICAgICBhZGRpdGlvblNlbnNvcnM6IGdldHRlcnMuZ2V0QWRkaXRpb25TZW5zb3JzKG5hbWVTcGxpdFsxXSksCiAgICAgICAgICBzcGVlZDogTWF0aC5yb3VuZCgoKF92YWx1ZSRzcGVlZCA9IHZhbHVlLnNwZWVkKSAhPT0gbnVsbCAmJiBfdmFsdWUkc3BlZWQgIT09IHZvaWQgMCA/IF92YWx1ZSRzcGVlZCA6IDApICogMTAwKSwKICAgICAgICAgIGF2Z1NwZWVkOiBNYXRoLnJvdW5kKChfZ2V0dGVycyR0ZW1wSGlzdG9yeTIgPSBnZXR0ZXJzWyd0ZW1wSGlzdG9yeS9nZXRBdmdTcGVlZCddKG5hbWUpKSAhPT0gbnVsbCAmJiBfZ2V0dGVycyR0ZW1wSGlzdG9yeTIgIT09IHZvaWQgMCA/IF9nZXR0ZXJzJHRlbXBIaXN0b3J5MiA6IDApLAogICAgICAgICAgcnBtOiB2YWx1ZS5ycG0gIT09IG51bGwgPyBNYXRoLnJvdW5kKHZhbHVlLnJwbSkgOiBudWxsLAogICAgICAgICAgcHJlc2V0czogcm9vdEdldHRlcnNbJ2d1aS9wcmVzZXRzL2dldFByZXNldHNGcm9tSGVhdGVyJ10oewogICAgICAgICAgICBuYW1lOiBrZXkKICAgICAgICAgIH0pLAogICAgICAgICAgY2hhcnRDb2xvcjogZ2V0dGVyc1sndGVtcEhpc3RvcnkvZ2V0RGF0YXNldENvbG9yJ10obmFtZVNwbGl0WzFdKSwKICAgICAgICAgIGNoYXJ0U2VyaWVzOiBnZXR0ZXJzWyd0ZW1wSGlzdG9yeS9nZXRTZXJpZU5hbWVzJ10obmFtZVNwbGl0WzFdKSwKICAgICAgICAgIG1pbl90ZW1wOiBwYXJzZUludCgoX3N0YXRlJGNvbmZpZ2ZpbGUkY29uNCA9IChfc3RhdGUkY29uZmlnZmlsZTYgPSBzdGF0ZS5jb25maWdmaWxlKSA9PT0gbnVsbCB8fCBfc3RhdGUkY29uZmlnZmlsZTYgPT09IHZvaWQgMCA/IHZvaWQgMCA6IChfc3RhdGUkY29uZmlnZmlsZTYkY28gPSBfc3RhdGUkY29uZmlnZmlsZTYuY29uZmlnW2tleV0pID09PSBudWxsIHx8IF9zdGF0ZSRjb25maWdmaWxlNiRjbyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3N0YXRlJGNvbmZpZ2ZpbGU2JGNvLm1pbl90ZW1wKSAhPT0gbnVsbCAmJiBfc3RhdGUkY29uZmlnZmlsZSRjb240ICE9PSB2b2lkIDAgPyBfc3RhdGUkY29uZmlnZmlsZSRjb240IDogMCksCiAgICAgICAgICBtYXhfdGVtcDogcGFyc2VJbnQoKF9zdGF0ZSRjb25maWdmaWxlJGNvbjUgPSAoX3N0YXRlJGNvbmZpZ2ZpbGU3ID0gc3RhdGUuY29uZmlnZmlsZSkgPT09IG51bGwgfHwgX3N0YXRlJGNvbmZpZ2ZpbGU3ID09PSB2b2lkIDAgPyB2b2lkIDAgOiAoX3N0YXRlJGNvbmZpZ2ZpbGU3JGNvID0gX3N0YXRlJGNvbmZpZ2ZpbGU3LmNvbmZpZ1trZXldKSA9PT0gbnVsbCB8fCBfc3RhdGUkY29uZmlnZmlsZTckY28gPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9zdGF0ZSRjb25maWdmaWxlNyRjby5tYXhfdGVtcCkgIT09IG51bGwgJiYgX3N0YXRlJGNvbmZpZ2ZpbGUkY29uNSAhPT0gdm9pZCAwID8gX3N0YXRlJGNvbmZpZ2ZpbGUkY29uNSA6IDApCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gY2FzZUluc2Vuc2l0aXZlU29ydChmYW5zLCAnbmFtZScpOwogIH0sCiAgZ2V0VGVtcGVyYXR1cmVTZW5zb3JzOiBmdW5jdGlvbiBnZXRUZW1wZXJhdHVyZVNlbnNvcnMoc3RhdGUsIGdldHRlcnMpIHsKICAgIHZhciBzZW5zb3JzID0gW107CgogICAgZm9yICh2YXIgX2kzID0gMCwgX09iamVjdCRlbnRyaWVzMyA9IE9iamVjdC5lbnRyaWVzKHN0YXRlKTsgX2kzIDwgX09iamVjdCRlbnRyaWVzMy5sZW5ndGg7IF9pMysrKSB7CiAgICAgIHZhciBfT2JqZWN0JGVudHJpZXMzJF9pID0gX3NsaWNlZFRvQXJyYXkoX09iamVjdCRlbnRyaWVzM1tfaTNdLCAyKSwKICAgICAgICAgIGtleSA9IF9PYmplY3QkZW50cmllczMkX2lbMF0sCiAgICAgICAgICB2YWx1ZSA9IF9PYmplY3QkZW50cmllczMkX2lbMV07CgogICAgICB2YXIgbmFtZVNwbGl0ID0ga2V5LnNwbGl0KCcgJyk7CgogICAgICBpZiAobmFtZVNwbGl0WzBdID09PSAndGVtcGVyYXR1cmVfc2Vuc29yJyAmJiAhbmFtZVNwbGl0WzFdLnN0YXJ0c1dpdGgoJ18nKSkgewogICAgICAgIHZhciBfc3RhdGUkY29uZmlnZmlsZSRzZXQsIF9zdGF0ZSRjb25maWdmaWxlOCwgX3N0YXRlJGNvbmZpZ2ZpbGU4JHNlLCBfc3RhdGUkY29uZmlnZmlsZSRzZXQyLCBfc3RhdGUkY29uZmlnZmlsZTksIF9zdGF0ZSRjb25maWdmaWxlOSRzZTsKCiAgICAgICAgdmFyIGljb24gPSAndGhlcm1vbWV0ZXInOwogICAgICAgIHZhciBtaW5fdGVtcCA9IChfc3RhdGUkY29uZmlnZmlsZSRzZXQgPSAoX3N0YXRlJGNvbmZpZ2ZpbGU4ID0gc3RhdGUuY29uZmlnZmlsZSkgPT09IG51bGwgfHwgX3N0YXRlJGNvbmZpZ2ZpbGU4ID09PSB2b2lkIDAgPyB2b2lkIDAgOiAoX3N0YXRlJGNvbmZpZ2ZpbGU4JHNlID0gX3N0YXRlJGNvbmZpZ2ZpbGU4LnNldHRpbmdzW2tleV0pID09PSBudWxsIHx8IF9zdGF0ZSRjb25maWdmaWxlOCRzZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3N0YXRlJGNvbmZpZ2ZpbGU4JHNlLm1pbl90ZW1wKSAhPT0gbnVsbCAmJiBfc3RhdGUkY29uZmlnZmlsZSRzZXQgIT09IHZvaWQgMCA/IF9zdGF0ZSRjb25maWdmaWxlJHNldCA6IDA7CiAgICAgICAgdmFyIG1heF90ZW1wID0gKF9zdGF0ZSRjb25maWdmaWxlJHNldDIgPSAoX3N0YXRlJGNvbmZpZ2ZpbGU5ID0gc3RhdGUuY29uZmlnZmlsZSkgPT09IG51bGwgfHwgX3N0YXRlJGNvbmZpZ2ZpbGU5ID09PSB2b2lkIDAgPyB2b2lkIDAgOiAoX3N0YXRlJGNvbmZpZ2ZpbGU5JHNlID0gX3N0YXRlJGNvbmZpZ2ZpbGU5LnNldHRpbmdzW2tleV0pID09PSBudWxsIHx8IF9zdGF0ZSRjb25maWdmaWxlOSRzZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3N0YXRlJGNvbmZpZ2ZpbGU5JHNlLm1heF90ZW1wKSAhPT0gbnVsbCAmJiBfc3RhdGUkY29uZmlnZmlsZSRzZXQyICE9PSB2b2lkIDAgPyBfc3RhdGUkY29uZmlnZmlsZSRzZXQyIDogMjEwOwogICAgICAgIHZhciBzcGxpdCA9IChtYXhfdGVtcCAtIG1pbl90ZW1wKSAvIDM7CiAgICAgICAgaWYgKHZhbHVlLnRlbXBlcmF0dXJlIDw9IG1pbl90ZW1wICsgc3BsaXQpIGljb24gPSAndGhlcm1vbWV0ZXItbG93JzsKICAgICAgICBpZiAodmFsdWUudGVtcGVyYXR1cmUgPj0gbWF4X3RlbXAgLSBzcGxpdCkgaWNvbiA9ICd0aGVybW9tZXRlci1oaWdoJzsKICAgICAgICBzZW5zb3JzLnB1c2goewogICAgICAgICAgbmFtZTogbmFtZVNwbGl0WzFdLAogICAgICAgICAgdGVtcGVyYXR1cmU6IE1hdGgucm91bmQodmFsdWUudGVtcGVyYXR1cmUgKiAxMCkgLyAxMCwKICAgICAgICAgIGFkZGl0aW9uU2Vuc29yczogZ2V0dGVycy5nZXRBZGRpdGlvblNlbnNvcnMobmFtZVNwbGl0WzFdKSwKICAgICAgICAgIGljb246IGljb24sCiAgICAgICAgICBtaW5fdGVtcDogbWluX3RlbXAsCiAgICAgICAgICBtYXhfdGVtcDogbWF4X3RlbXAsCiAgICAgICAgICBtZWFzdXJlZF9taW5fdGVtcDogTWF0aC5yb3VuZCh2YWx1ZS5tZWFzdXJlZF9taW5fdGVtcCAqIDEwKSAvIDEwLAogICAgICAgICAgbWVhc3VyZWRfbWF4X3RlbXA6IE1hdGgucm91bmQodmFsdWUubWVhc3VyZWRfbWF4X3RlbXAgKiAxMCkgLyAxMCwKICAgICAgICAgIGNoYXJ0Q29sb3I6IGdldHRlcnNbJ3RlbXBIaXN0b3J5L2dldERhdGFzZXRDb2xvciddKG5hbWVTcGxpdFsxXSksCiAgICAgICAgICBjaGFydFNlcmllczogZ2V0dGVyc1sndGVtcEhpc3RvcnkvZ2V0U2VyaWVOYW1lcyddKG5hbWVTcGxpdFsxXSkKICAgICAgICB9KTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiBjYXNlSW5zZW5zaXRpdmVTb3J0KHNlbnNvcnMsICduYW1lJyk7CiAgfSwKICBnZXRQYXJ0RmFuU3BlZWQ6IGZ1bmN0aW9uIGdldFBhcnRGYW5TcGVlZChzdGF0ZSkgewogICAgcmV0dXJuICdmYW4nIGluIHN0YXRlID8gc3RhdGUuZmFuLnNwZWVkIDogMDsKICB9LAogIGdldEZhbnM6IGZ1bmN0aW9uIGdldEZhbnMoc3RhdGUpIHsKICAgIHZhciBmYW5zID0gW107CiAgICB2YXIgc3VwcG9ydGVkRmFucyA9IFsndGVtcGVyYXR1cmVfZmFuJywgJ2NvbnRyb2xsZXJfZmFuJywgJ2hlYXRlcl9mYW4nLCAnZmFuX2dlbmVyaWMnLCAnZmFuJ107CiAgICB2YXIgY29udHJvbGxhYmxlRmFucyA9IFsnZmFuX2dlbmVyaWMnLCAnZmFuJ107CgogICAgZm9yICh2YXIgX2k0ID0gMCwgX09iamVjdCRlbnRyaWVzNCA9IE9iamVjdC5lbnRyaWVzKHN0YXRlKTsgX2k0IDwgX09iamVjdCRlbnRyaWVzNC5sZW5ndGg7IF9pNCsrKSB7CiAgICAgIHZhciBfT2JqZWN0JGVudHJpZXM0JF9pID0gX3NsaWNlZFRvQXJyYXkoX09iamVjdCRlbnRyaWVzNFtfaTRdLCAyKSwKICAgICAgICAgIGtleSA9IF9PYmplY3QkZW50cmllczQkX2lbMF0sCiAgICAgICAgICB2YWx1ZSA9IF9PYmplY3QkZW50cmllczQkX2lbMV07CgogICAgICB2YXIgbmFtZVNwbGl0ID0ga2V5LnNwbGl0KCcgJyk7CgogICAgICBpZiAoc3VwcG9ydGVkRmFucy5pbmNsdWRlcyhuYW1lU3BsaXRbMF0pKSB7CiAgICAgICAgdmFyIF9uYW1lMiA9IG5hbWVTcGxpdC5sZW5ndGggPiAxID8gbmFtZVNwbGl0WzFdIDogbmFtZVNwbGl0WzBdOwoKICAgICAgICBmYW5zLnB1c2goewogICAgICAgICAgbmFtZTogX25hbWUyLAogICAgICAgICAgdHlwZTogbmFtZVNwbGl0WzBdLAogICAgICAgICAgc3BlZWQ6ICdzcGVlZCcgaW4gdmFsdWUgPyB2YWx1ZS5zcGVlZCA6IDAsCiAgICAgICAgICBjb250cm9sbGFibGU6IGNvbnRyb2xsYWJsZUZhbnMuaW5jbHVkZXMobmFtZVNwbGl0WzBdKQogICAgICAgIH0pOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIGZhbnMuc29ydChmdW5jdGlvbiAoYSwgYikgewogICAgICBpZiAoYS5jb250cm9sbGFibGUgPCBiLmNvbnRyb2xsYWJsZSkgcmV0dXJuIDE7CiAgICAgIGlmIChhLmNvbnRyb2xsYWJsZSA+IGIuY29udHJvbGxhYmxlKSByZXR1cm4gLTE7CiAgICAgIHZhciBuYW1lQSA9IGEubmFtZS50b1VwcGVyQ2FzZSgpOwogICAgICB2YXIgbmFtZUIgPSBiLm5hbWUudG9VcHBlckNhc2UoKTsKICAgICAgaWYgKG5hbWVBIDwgbmFtZUIpIHJldHVybiAtMTsKICAgICAgaWYgKG5hbWVBID4gbmFtZUIpIHJldHVybiAxOwogICAgICByZXR1cm4gMDsKICAgIH0pOwogIH0sCiAgZ2V0TWlzY2VsbGFuZW91czogZnVuY3Rpb24gZ2V0TWlzY2VsbGFuZW91cyhzdGF0ZSkgewogICAgdmFyIG91dHB1dCA9IFtdOwogICAgdmFyIHN1cHBvcnRlZE9iamVjdHMgPSBbJ2NvbnRyb2xsZXJfZmFuJywgJ2hlYXRlcl9mYW4nLCAnZmFuX2dlbmVyaWMnLCAnZmFuJywgJ291dHB1dF9waW4nXTsKICAgIHZhciBjb250cm9sbGFibGVGYW5zID0gWydmYW5fZ2VuZXJpYycsICdmYW4nXTsKCiAgICBmb3IgKHZhciBfaTUgPSAwLCBfT2JqZWN0JGVudHJpZXM1ID0gT2JqZWN0LmVudHJpZXMoc3RhdGUpOyBfaTUgPCBfT2JqZWN0JGVudHJpZXM1Lmxlbmd0aDsgX2k1KyspIHsKICAgICAgdmFyIF9PYmplY3QkZW50cmllczUkX2kgPSBfc2xpY2VkVG9BcnJheShfT2JqZWN0JGVudHJpZXM1W19pNV0sIDIpLAogICAgICAgICAga2V5ID0gX09iamVjdCRlbnRyaWVzNSRfaVswXSwKICAgICAgICAgIHZhbHVlID0gX09iamVjdCRlbnRyaWVzNSRfaVsxXTsKCiAgICAgIHZhciBuYW1lU3BsaXQgPSBrZXkuc3BsaXQoJyAnKTsKCiAgICAgIGlmIChzdXBwb3J0ZWRPYmplY3RzLmluY2x1ZGVzKG5hbWVTcGxpdFswXSkpIHsKICAgICAgICB2YXIgX25hbWUzID0gbmFtZVNwbGl0Lmxlbmd0aCA+IDEgPyBuYW1lU3BsaXRbMV0gOiBuYW1lU3BsaXRbMF07CgogICAgICAgIGlmICghX25hbWUzLnN0YXJ0c1dpdGgoJ18nKSkgewogICAgICAgICAgdmFyIF9zdGF0ZSRjb25maWdmaWxlJHNldDMsIF9zdGF0ZSRjb25maWdmaWxlMTA7CgogICAgICAgICAgdmFyIGNvbnRyb2xsYWJsZSA9IGNvbnRyb2xsYWJsZUZhbnMuaW5jbHVkZXMobmFtZVNwbGl0WzBdLnRvTG93ZXJDYXNlKCkpOwogICAgICAgICAgdmFyIHNldHRpbmdzID0gKF9zdGF0ZSRjb25maWdmaWxlJHNldDMgPSAoX3N0YXRlJGNvbmZpZ2ZpbGUxMCA9IHN0YXRlLmNvbmZpZ2ZpbGUpID09PSBudWxsIHx8IF9zdGF0ZSRjb25maWdmaWxlMTAgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9zdGF0ZSRjb25maWdmaWxlMTAuc2V0dGluZ3Nba2V5LnRvTG93ZXJDYXNlKCldKSAhPT0gbnVsbCAmJiBfc3RhdGUkY29uZmlnZmlsZSRzZXQzICE9PSB2b2lkIDAgPyBfc3RhdGUkY29uZmlnZmlsZSRzZXQzIDoge307CiAgICAgICAgICB2YXIgcG93ZXIgPSAnc3BlZWQnIGluIHZhbHVlID8gdmFsdWUuc3BlZWQgOiAndmFsdWUnIGluIHZhbHVlID8gdmFsdWUudmFsdWUgOiAwOwogICAgICAgICAgdmFyIHJwbSA9ICdycG0nIGluIHZhbHVlID8gdmFsdWUucnBtIDogZmFsc2U7CiAgICAgICAgICB2YXIgcHdtID0gY29udHJvbGxhYmxlOwogICAgICAgICAgdmFyIHNjYWxlID0gMTsKICAgICAgICAgIGlmIChuYW1lU3BsaXRbMF0udG9Mb3dlckNhc2UoKSA9PT0gJ2ZhbicpIHNjYWxlID0gMjU1OwoKICAgICAgICAgIGlmIChuYW1lU3BsaXRbMF0udG9Mb3dlckNhc2UoKSA9PT0gJ291dHB1dF9waW4nKSB7CiAgICAgICAgICAgIHZhciBfc2V0dGluZ3MkcHdtLCBfc2V0dGluZ3Mkc2NhbGU7CgogICAgICAgICAgICBjb250cm9sbGFibGUgPSB0cnVlOwogICAgICAgICAgICBwd20gPSBmYWxzZTsKICAgICAgICAgICAgaWYgKCdwd20nIGluIHNldHRpbmdzKSBwd20gPSAoX3NldHRpbmdzJHB3bSA9IHNldHRpbmdzID09PSBudWxsIHx8IHNldHRpbmdzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzZXR0aW5ncy5wd20pICE9PSBudWxsICYmIF9zZXR0aW5ncyRwd20gIT09IHZvaWQgMCA/IF9zZXR0aW5ncyRwd20gOiBmYWxzZTsKICAgICAgICAgICAgaWYgKCdzY2FsZScgaW4gc2V0dGluZ3MpIHNjYWxlID0gKF9zZXR0aW5ncyRzY2FsZSA9IHNldHRpbmdzID09PSBudWxsIHx8IHNldHRpbmdzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBzZXR0aW5ncy5zY2FsZSkgIT09IG51bGwgJiYgX3NldHRpbmdzJHNjYWxlICE9PSB2b2lkIDAgPyBfc2V0dGluZ3Mkc2NhbGUgOiAxOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciB0bXAgPSB7CiAgICAgICAgICAgIG5hbWU6IF9uYW1lMywKICAgICAgICAgICAgdHlwZTogbmFtZVNwbGl0WzBdLAogICAgICAgICAgICBwb3dlcjogcG93ZXIsCiAgICAgICAgICAgIGNvbnRyb2xsYWJsZTogY29udHJvbGxhYmxlLAogICAgICAgICAgICBwd206IHB3bSwKICAgICAgICAgICAgcnBtOiBycG0sCiAgICAgICAgICAgIHNjYWxlOiBzY2FsZSwKICAgICAgICAgICAgb2JqZWN0OiB2YWx1ZSwKICAgICAgICAgICAgY29uZmlnOiBzZXR0aW5ncywKICAgICAgICAgICAgb2ZmX2JlbG93OiB1bmRlZmluZWQsCiAgICAgICAgICAgIG1heF9wb3dlcjogdW5kZWZpbmVkCiAgICAgICAgICB9OwoKICAgICAgICAgIGlmICgnc2V0dGluZ3MnIGluIHN0YXRlLmNvbmZpZ2ZpbGUgJiYga2V5LnRvTG93ZXJDYXNlKCkgaW4gc3RhdGUuY29uZmlnZmlsZS5zZXR0aW5ncykgewogICAgICAgICAgICB2YXIgX3NldHRpbmdzJG9mZl9iZWxvdywgX3NldHRpbmdzJG1heF9wb3dlcjsKCiAgICAgICAgICAgIGlmICgnb2ZmX2JlbG93JyBpbiBzZXR0aW5ncykgdG1wLm9mZl9iZWxvdyA9IChfc2V0dGluZ3Mkb2ZmX2JlbG93ID0gc2V0dGluZ3MgPT09IG51bGwgfHwgc2V0dGluZ3MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNldHRpbmdzLm9mZl9iZWxvdykgIT09IG51bGwgJiYgX3NldHRpbmdzJG9mZl9iZWxvdyAhPT0gdm9pZCAwID8gX3NldHRpbmdzJG9mZl9iZWxvdyA6IDA7CiAgICAgICAgICAgIGlmICgnbWF4X3Bvd2VyJyBpbiBzZXR0aW5ncykgdG1wLm1heF9wb3dlciA9IChfc2V0dGluZ3MkbWF4X3Bvd2VyID0gc2V0dGluZ3MgPT09IG51bGwgfHwgc2V0dGluZ3MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHNldHRpbmdzLm1heF9wb3dlcikgIT09IG51bGwgJiYgX3NldHRpbmdzJG1heF9wb3dlciAhPT0gdm9pZCAwID8gX3NldHRpbmdzJG1heF9wb3dlciA6IDE7CiAgICAgICAgICB9CgogICAgICAgICAgb3V0cHV0LnB1c2godG1wKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gb3V0cHV0LnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgaWYgKGEudHlwZSA9PT0gJ2ZhbicpIHJldHVybiAtMTsKICAgICAgaWYgKGIudHlwZSA9PT0gJ2ZhbicpIHJldHVybiAxOwogICAgICBpZiAoYS5wd20gPCBiLnB3bSkgcmV0dXJuIDE7CiAgICAgIGlmIChhLnB3bSA+IGIucHdtKSByZXR1cm4gLTE7CiAgICAgIGlmIChhLmNvbnRyb2xsYWJsZSA8IGIuY29udHJvbGxhYmxlKSByZXR1cm4gMTsKICAgICAgaWYgKGEuY29udHJvbGxhYmxlID4gYi5jb250cm9sbGFibGUpIHJldHVybiAtMTsKICAgICAgdmFyIG5hbWVBID0gYS5uYW1lLnRvVXBwZXJDYXNlKCk7CiAgICAgIHZhciBuYW1lQiA9IGIubmFtZS50b1VwcGVyQ2FzZSgpOwogICAgICBpZiAobmFtZUEgPCBuYW1lQikgcmV0dXJuIC0xOwogICAgICBpZiAobmFtZUEgPiBuYW1lQikgcmV0dXJuIDE7CiAgICAgIHJldHVybiAwOwogICAgfSk7CiAgfSwKICBnZXRBZGRpdGlvblNlbnNvcnM6IGZ1bmN0aW9uIGdldEFkZGl0aW9uU2Vuc29ycyhzdGF0ZSwgZ2V0dGVycywgcm9vdFN0YXRlLCByb290R2V0dGVycykgewogICAgcmV0dXJuIGZ1bmN0aW9uIChuYW1lKSB7CiAgICAgIHZhciBhZGRpdGlvblZhbHVlcyA9IHt9OwogICAgICBhZGRpdGlvbmFsU2Vuc29ycy5mb3JFYWNoKGZ1bmN0aW9uIChzZW5zb3JOYW1lKSB7CiAgICAgICAgaWYgKHNlbnNvck5hbWUgKyAnICcgKyBuYW1lIGluIHN0YXRlKSB7CiAgICAgICAgICBPYmplY3Qua2V5cyhzdGF0ZVtzZW5zb3JOYW1lICsgJyAnICsgbmFtZV0pLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgICAgICBpZiAoa2V5ICE9PSAndGVtcGVyYXR1cmUnKSB7CiAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lCiAgICAgICAgICAgICAgdmFyIHRtcCA9IHt9OwogICAgICAgICAgICAgIHRtcFtrZXldID0ge307CiAgICAgICAgICAgICAgdG1wW2tleV1bJ3ZhbHVlJ10gPSBzdGF0ZVtzZW5zb3JOYW1lICsgJyAnICsgbmFtZV1ba2V5XS50b0ZpeGVkKDEpOwogICAgICAgICAgICAgIHRtcFtrZXldWydib29sJ10gPSByb290R2V0dGVyc1snZ3VpL2dldERhdGFzZXRBZGRpdGlvbmFsU2Vuc29yVmFsdWUnXSh7CiAgICAgICAgICAgICAgICBuYW1lOiBuYW1lLAogICAgICAgICAgICAgICAgc2Vuc29yOiBrZXkKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgc3dpdGNoIChrZXkpIHsKICAgICAgICAgICAgICAgIGNhc2UgJ3ByZXNzdXJlJzoKICAgICAgICAgICAgICAgICAgdG1wW2tleV1bJ3VuaXQnXSA9ICdoUGEnOwogICAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgICBjYXNlICdodW1pZGl0eSc6CiAgICAgICAgICAgICAgICAgIHRtcFtrZXldWyd1bml0J10gPSAnJSc7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgIHRtcFtrZXldWyd1bml0J10gPSAnJzsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGFkZGl0aW9uVmFsdWVzID0gT2JqZWN0LmFzc2lnbihhZGRpdGlvblZhbHVlcywgdG1wKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgcmV0dXJuIGFkZGl0aW9uVmFsdWVzOwogICAgfTsKICB9LAogIGdldEF2YWlsYWJsZVNlbnNvcnM6IGZ1bmN0aW9uIGdldEF2YWlsYWJsZVNlbnNvcnMoc3RhdGUpIHsKICAgIHZhciBfc3RhdGUkaGVhdGVycyRhdmFpbGEsIF9zdGF0ZSRoZWF0ZXJzMjsKCiAgICByZXR1cm4gKF9zdGF0ZSRoZWF0ZXJzJGF2YWlsYSA9IChfc3RhdGUkaGVhdGVyczIgPSBzdGF0ZS5oZWF0ZXJzKSA9PT0gbnVsbCB8fCBfc3RhdGUkaGVhdGVyczIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9zdGF0ZSRoZWF0ZXJzMi5hdmFpbGFibGVfc2Vuc29ycykgIT09IG51bGwgJiYgX3N0YXRlJGhlYXRlcnMkYXZhaWxhICE9PSB2b2lkIDAgPyBfc3RhdGUkaGVhdGVycyRhdmFpbGEgOiBbXTsKICB9LAogIGdldEFsbE1hY3JvczogZnVuY3Rpb24gZ2V0QWxsTWFjcm9zKHN0YXRlKSB7CiAgICB2YXIgX3N0YXRlJGNvbmZpZ2ZpbGUkY29uNiwgX3N0YXRlJGNvbmZpZ2ZpbGUxMTsKCiAgICB2YXIgYXJyYXkgPSBbXTsKICAgIE9iamVjdC5rZXlzKChfc3RhdGUkY29uZmlnZmlsZSRjb242ID0gKF9zdGF0ZSRjb25maWdmaWxlMTEgPSBzdGF0ZS5jb25maWdmaWxlKSA9PT0gbnVsbCB8fCBfc3RhdGUkY29uZmlnZmlsZTExID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfc3RhdGUkY29uZmlnZmlsZTExLmNvbmZpZykgIT09IG51bGwgJiYgX3N0YXRlJGNvbmZpZ2ZpbGUkY29uNiAhPT0gdm9pZCAwID8gX3N0YXRlJGNvbmZpZ2ZpbGUkY29uNiA6IHt9KS5mb3JFYWNoKGZ1bmN0aW9uIChwcm9wKSB7CiAgICAgIGlmIChwcm9wLnN0YXJ0c1dpdGgoJ2djb2RlX21hY3JvJykgJiYgIXByb3Auc3RhcnRzV2l0aCgnZ2NvZGVfbWFjcm8gXycpICYmICFPYmplY3QuaGFzT3duUHJvcGVydHkuY2FsbChzdGF0ZS5jb25maWdmaWxlLmNvbmZpZ1twcm9wXSwgJ3JlbmFtZV9leGlzdGluZycpKSB7CiAgICAgICAgdmFyIF9zdGF0ZSRjb25maWdmaWxlJGNvbjc7CgogICAgICAgIGFycmF5LnB1c2goewogICAgICAgICAgJ25hbWUnOiBwcm9wLnJlcGxhY2UoJ2djb2RlX21hY3JvICcsICcnKSwKICAgICAgICAgICdkZXNjcmlwdGlvbic6IChfc3RhdGUkY29uZmlnZmlsZSRjb243ID0gc3RhdGUuY29uZmlnZmlsZS5jb25maWdbcHJvcF0uZGVzY3JpcHRpb24pICE9PSBudWxsICYmIF9zdGF0ZSRjb25maWdmaWxlJGNvbjcgIT09IHZvaWQgMCA/IF9zdGF0ZSRjb25maWdmaWxlJGNvbjcgOiBudWxsLAogICAgICAgICAgJ3Byb3AnOiBzdGF0ZS5jb25maWdmaWxlLmNvbmZpZ1twcm9wXSwKICAgICAgICAgICdwYXJhbXMnOiBnZXRNYWNyb1BhcmFtcyhzdGF0ZS5jb25maWdmaWxlLmNvbmZpZ1twcm9wXSkKICAgICAgICB9KTsKICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gY2FzZUluc2Vuc2l0aXZlU29ydChhcnJheSwgJ25hbWUnKTsKICB9LAogIGdldE1hY3JvOiBmdW5jdGlvbiBnZXRNYWNybyhzdGF0ZSkgewogICAgcmV0dXJuIGZ1bmN0aW9uIChuYW1lKSB7CiAgICAgIGlmICgnZ2NvZGVfbWFjcm8gJyArIG5hbWUgaW4gc3RhdGUuY29uZmlnZmlsZS5jb25maWcpIHsKICAgICAgICB2YXIgX2NvbmZpZyRkZXNjcmlwdGlvbjsKCiAgICAgICAgdmFyIGNvbmZpZyA9IHN0YXRlLmNvbmZpZ2ZpbGUuY29uZmlnWydnY29kZV9tYWNybyAnICsgbmFtZV07CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIG5hbWU6IG5hbWUsCiAgICAgICAgICBkZXNjcmlwdGlvbjogKF9jb25maWckZGVzY3JpcHRpb24gPSBjb25maWcuZGVzY3JpcHRpb24pICE9PSBudWxsICYmIF9jb25maWckZGVzY3JpcHRpb24gIT09IHZvaWQgMCA/IF9jb25maWckZGVzY3JpcHRpb24gOiBudWxsLAogICAgICAgICAgcHJvcDogY29uZmlnLAogICAgICAgICAgcGFyYW1zOiBnZXRNYWNyb1BhcmFtcyhjb25maWcpCiAgICAgICAgfTsKICAgICAgfQoKICAgICAgcmV0dXJuIG51bGw7CiAgICB9OwogIH0sCiAgZ2V0RmlsYW1lbnRTZW5zb3JzOiBmdW5jdGlvbiBnZXRGaWxhbWVudFNlbnNvcnMoc3RhdGUpIHsKICAgIHZhciBzZW5zb3JPYmplY3ROYW1lcyA9IFsnZmlsYW1lbnRfc3dpdGNoX3NlbnNvcicsICdmaWxhbWVudF9tb3Rpb25fc2Vuc29yJ107CiAgICB2YXIgc2Vuc29ycyA9IFtdOwoKICAgIGZvciAodmFyIF9pNiA9IDAsIF9PYmplY3QkZW50cmllczYgPSBPYmplY3QuZW50cmllcyhzdGF0ZSk7IF9pNiA8IF9PYmplY3QkZW50cmllczYubGVuZ3RoOyBfaTYrKykgewogICAgICB2YXIgX09iamVjdCRlbnRyaWVzNiRfaSA9IF9zbGljZWRUb0FycmF5KF9PYmplY3QkZW50cmllczZbX2k2XSwgMiksCiAgICAgICAgICBrZXkgPSBfT2JqZWN0JGVudHJpZXM2JF9pWzBdLAogICAgICAgICAgdmFsdWUgPSBfT2JqZWN0JGVudHJpZXM2JF9pWzFdOwoKICAgICAgdmFyIG5hbWVTcGxpdCA9IGtleS5zcGxpdCgnICcpOwoKICAgICAgaWYgKHNlbnNvck9iamVjdE5hbWVzLmluY2x1ZGVzKG5hbWVTcGxpdFswXSkpIHsKICAgICAgICBzZW5zb3JzLnB1c2goewogICAgICAgICAgbmFtZTogbmFtZVNwbGl0WzFdLAogICAgICAgICAgZW5hYmxlZDogdmFsdWUuZW5hYmxlZCwKICAgICAgICAgIGZpbGFtZW50X2RldGVjdGVkOiB2YWx1ZS5maWxhbWVudF9kZXRlY3RlZAogICAgICAgIH0pOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIGNhc2VJbnNlbnNpdGl2ZVNvcnQoc2Vuc29ycywgJ25hbWUnKTsKICB9LAogIGdldE1jdXM6IGZ1bmN0aW9uIGdldE1jdXMoc3RhdGUsIGdldHRlcnMpIHsKICAgIHZhciBtY3VzID0gW107CiAgICBPYmplY3Qua2V5cyhzdGF0ZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CiAgICAgIGlmIChrZXkgPT09ICdtY3UnIHx8IGtleS5zdGFydHNXaXRoKCdtY3UgJykpIHsKICAgICAgICB2YXIgX21jdSRtY3VfdmVyc2lvbiwgX21jdSRsYXN0X3N0YXRzLCBfbWN1JGxhc3Rfc3RhdHMyLCBfbWN1JG1jdV9jb25zdGFudHMkTUMsIF9tY3UkbWN1X2NvbnN0YW50cywgX21jdSRsYXN0X3N0YXRzJGZyZXEsIF9tY3UkbGFzdF9zdGF0czQsIF9tY3UkbGFzdF9zdGF0cyRmcmVxMiwgX21jdSRsYXN0X3N0YXRzNSwgX21jdSRsYXN0X3N0YXRzJG1jdV9hLCBfbWN1JGxhc3Rfc3RhdHM2OwoKICAgICAgICB2YXIgbWN1ID0gc3RhdGVba2V5XTsKICAgICAgICB2YXIgdmVyc2lvbk91dHB1dCA9ICgoX21jdSRtY3VfdmVyc2lvbiA9IG1jdS5tY3VfdmVyc2lvbikgIT09IG51bGwgJiYgX21jdSRtY3VfdmVyc2lvbiAhPT0gdm9pZCAwID8gX21jdSRtY3VfdmVyc2lvbiA6ICd1bmtub3duJykuc3BsaXQoJy0nKS5zbGljZSgwLCA0KS5qb2luKCctJyk7CiAgICAgICAgdmFyIGxvYWQgPSAwOwoKICAgICAgICBpZiAoKF9tY3UkbGFzdF9zdGF0cyA9IG1jdS5sYXN0X3N0YXRzKSAhPT0gbnVsbCAmJiBfbWN1JGxhc3Rfc3RhdHMgIT09IHZvaWQgMCAmJiBfbWN1JGxhc3Rfc3RhdHMubWN1X3Rhc2tfYXZnICYmIChfbWN1JGxhc3Rfc3RhdHMyID0gbWN1Lmxhc3Rfc3RhdHMpICE9PSBudWxsICYmIF9tY3UkbGFzdF9zdGF0czIgIT09IHZvaWQgMCAmJiBfbWN1JGxhc3Rfc3RhdHMyLm1jdV90YXNrX3N0ZGRldikgewogICAgICAgICAgdmFyIF9tY3UkbGFzdF9zdGF0czM7CgogICAgICAgICAgbG9hZCA9IG1jdS5sYXN0X3N0YXRzLm1jdV90YXNrX2F2ZyArIDMgKiAoKF9tY3UkbGFzdF9zdGF0czMgPSBtY3UubGFzdF9zdGF0cykgPT09IG51bGwgfHwgX21jdSRsYXN0X3N0YXRzMyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX21jdSRsYXN0X3N0YXRzMy5tY3VfdGFza19zdGRkZXYpIC8gMC4wMDI1OwogICAgICAgIH0KCiAgICAgICAgdmFyIGxvYWRQcm9ncmVzc0NvbG9yID0gJ3ByaW1hcnknOwogICAgICAgIGlmIChsb2FkID4gMC45NSkgbG9hZFByb2dyZXNzQ29sb3IgPSAnZXJyb3InO2Vsc2UgaWYgKGxvYWQgPiAwLjgpIGxvYWRQcm9ncmVzc0NvbG9yID0gJ3dhcm5pbmcnOwogICAgICAgIG1jdXMucHVzaCh7CiAgICAgICAgICBuYW1lOiBrZXksCiAgICAgICAgICBtY3VfY29uc3RhbnRzOiBtY3UubWN1X2NvbnN0YW50cywKICAgICAgICAgIGxhc3Rfc3RhdHM6IG1jdS5sYXN0X3N0YXRzLAogICAgICAgICAgdmVyc2lvbjogdmVyc2lvbk91dHB1dCwKICAgICAgICAgIGNoaXA6IChfbWN1JG1jdV9jb25zdGFudHMkTUMgPSAoX21jdSRtY3VfY29uc3RhbnRzID0gbWN1Lm1jdV9jb25zdGFudHMpID09PSBudWxsIHx8IF9tY3UkbWN1X2NvbnN0YW50cyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX21jdSRtY3VfY29uc3RhbnRzLk1DVSkgIT09IG51bGwgJiYgX21jdSRtY3VfY29uc3RhbnRzJE1DICE9PSB2b2lkIDAgPyBfbWN1JG1jdV9jb25zdGFudHMkTUMgOiBudWxsLAogICAgICAgICAgZnJlcTogKF9tY3UkbGFzdF9zdGF0cyRmcmVxID0gKF9tY3UkbGFzdF9zdGF0czQgPSBtY3UubGFzdF9zdGF0cykgPT09IG51bGwgfHwgX21jdSRsYXN0X3N0YXRzNCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX21jdSRsYXN0X3N0YXRzNC5mcmVxKSAhPT0gbnVsbCAmJiBfbWN1JGxhc3Rfc3RhdHMkZnJlcSAhPT0gdm9pZCAwID8gX21jdSRsYXN0X3N0YXRzJGZyZXEgOiBudWxsLAogICAgICAgICAgZnJlcUZvcm1hdDogZm9ybWF0RnJlcXVlbmN5KChfbWN1JGxhc3Rfc3RhdHMkZnJlcTIgPSAoX21jdSRsYXN0X3N0YXRzNSA9IG1jdS5sYXN0X3N0YXRzKSA9PT0gbnVsbCB8fCBfbWN1JGxhc3Rfc3RhdHM1ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfbWN1JGxhc3Rfc3RhdHM1LmZyZXEpICE9PSBudWxsICYmIF9tY3UkbGFzdF9zdGF0cyRmcmVxMiAhPT0gdm9pZCAwID8gX21jdSRsYXN0X3N0YXRzJGZyZXEyIDogMCksCiAgICAgICAgICBhd2FrZTogKCgoX21jdSRsYXN0X3N0YXRzJG1jdV9hID0gKF9tY3UkbGFzdF9zdGF0czYgPSBtY3UubGFzdF9zdGF0cykgPT09IG51bGwgfHwgX21jdSRsYXN0X3N0YXRzNiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX21jdSRsYXN0X3N0YXRzNi5tY3VfYXdha2UpICE9PSBudWxsICYmIF9tY3UkbGFzdF9zdGF0cyRtY3VfYSAhPT0gdm9pZCAwID8gX21jdSRsYXN0X3N0YXRzJG1jdV9hIDogMCkgLyA1KS50b0ZpeGVkKDIpLAogICAgICAgICAgbG9hZDogbG9hZC50b0ZpeGVkKDIpLAogICAgICAgICAgbG9hZFBlcmNlbnQ6IGxvYWQgPCAxID8gTWF0aC5yb3VuZChsb2FkICogMTAwKSA6IDEwMCwKICAgICAgICAgIGxvYWRQcm9ncmVzc0NvbG9yOiBsb2FkUHJvZ3Jlc3NDb2xvciwKICAgICAgICAgIHRlbXBTZW5zb3I6IGdldHRlcnMuZ2V0TWN1VGVtcFNlbnNvcihrZXkpCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIG1jdXM7CiAgfSwKICBnZXRQcmludGVyT2JqZWN0OiBmdW5jdGlvbiBnZXRQcmludGVyT2JqZWN0KHN0YXRlKSB7CiAgICByZXR1cm4gZnVuY3Rpb24gKG9iamVjdE5hbWUpIHsKICAgICAgaWYgKG9iamVjdE5hbWUgaW4gc3RhdGUpIHJldHVybiBzdGF0ZVtvYmplY3ROYW1lXTsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9OwogIH0sCiAgZ2V0UHJpbnRlckNvbmZpZ09iamVjdHM6IGZ1bmN0aW9uIGdldFByaW50ZXJDb25maWdPYmplY3RzKHN0YXRlKSB7CiAgICByZXR1cm4gZnVuY3Rpb24gKG9iamVjdE5hbWVzKSB7CiAgICAgIHZhciBfc3RhdGUkY29uZmlnZmlsZTEyOwoKICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lCiAgICAgIHZhciBvdXRwdXQgPSB7fTsKCiAgICAgIGlmICgoX3N0YXRlJGNvbmZpZ2ZpbGUxMiA9IHN0YXRlLmNvbmZpZ2ZpbGUpICE9PSBudWxsICYmIF9zdGF0ZSRjb25maWdmaWxlMTIgIT09IHZvaWQgMCAmJiBfc3RhdGUkY29uZmlnZmlsZTEyLnNldHRpbmdzKSB7CiAgICAgICAgT2JqZWN0LmtleXMoc3RhdGUuY29uZmlnZmlsZS5zZXR0aW5ncykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgICB2YXIga2V5U3BsaXRzID0ga2V5LnNwbGl0KCcgJyk7CgogICAgICAgICAgaWYgKG9iamVjdE5hbWVzLmluY2x1ZGVzKGtleVNwbGl0c1swXSkpIHsKICAgICAgICAgICAgb3V0cHV0W2tleV0gPSBzdGF0ZS5jb25maWdmaWxlLnNldHRpbmdzW2tleV07CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHJldHVybiBvdXRwdXQ7CiAgICB9OwogIH0sCiAgZ2V0SG9zdFRlbXBTZW5zb3I6IGZ1bmN0aW9uIGdldEhvc3RUZW1wU2Vuc29yKHN0YXRlLCBnZXR0ZXJzKSB7CiAgICB2YXIgc2Vuc29yVHlwZXMgPSBbJ3JwaV90ZW1wZXJhdHVyZScsICd0ZW1wZXJhdHVyZV9ob3N0J107CiAgICB2YXIgY2hlY2tPYmplY3RzID0gWyd0ZW1wZXJhdHVyZV9zZW5zb3InLCAndGVtcGVyYXR1cmVfZmFuJ107CiAgICB2YXIgb3V0cHV0ID0gbnVsbDsKICAgIHZhciBvYmplY3RzID0gZ2V0dGVycy5nZXRQcmludGVyQ29uZmlnT2JqZWN0cyhjaGVja09iamVjdHMpOwogICAgT2JqZWN0LmtleXMob2JqZWN0cykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CiAgICAgIHZhciBzZXR0aW5ncyA9IG9iamVjdHNba2V5XTsKICAgICAgdmFyIGNhc2VLZXkgPSBPYmplY3Qua2V5cyhzdGF0ZSkuZmluZChmdW5jdGlvbiAoc3RhdGVfa2V5KSB7CiAgICAgICAgcmV0dXJuIHN0YXRlX2tleS50b0xvd2VyQ2FzZSgpID09PSBrZXkudG9Mb3dlckNhc2UoKTsKICAgICAgfSkgfHwgJyc7CgogICAgICBpZiAoJ3NlbnNvcl90eXBlJyBpbiBzZXR0aW5ncyAmJiBzZW5zb3JUeXBlcy5pbmNsdWRlcyhzZXR0aW5ncy5zZW5zb3JfdHlwZSkgJiYgY2FzZUtleSBpbiBzdGF0ZSkgewogICAgICAgIHZhciBfdmFsdWUkdGVtcGVyYXR1cmUsIF92YWx1ZSRtZWFzdXJlZF9taW5fdCwgX3ZhbHVlJG1lYXN1cmVkX21heF90OwoKICAgICAgICB2YXIgdmFsdWUgPSBzdGF0ZVtjYXNlS2V5XTsKICAgICAgICBvdXRwdXQgPSB7CiAgICAgICAgICB0ZW1wZXJhdHVyZTogKF92YWx1ZSR0ZW1wZXJhdHVyZSA9IHZhbHVlLnRlbXBlcmF0dXJlKSA9PT0gbnVsbCB8fCBfdmFsdWUkdGVtcGVyYXR1cmUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF92YWx1ZSR0ZW1wZXJhdHVyZS50b0ZpeGVkKDApLAogICAgICAgICAgbWVhc3VyZWRfbWluX3RlbXA6IChfdmFsdWUkbWVhc3VyZWRfbWluX3QgPSB2YWx1ZS5tZWFzdXJlZF9taW5fdGVtcCkgPT09IG51bGwgfHwgX3ZhbHVlJG1lYXN1cmVkX21pbl90ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfdmFsdWUkbWVhc3VyZWRfbWluX3QudG9GaXhlZCgxKSwKICAgICAgICAgIG1lYXN1cmVkX21heF90ZW1wOiAoX3ZhbHVlJG1lYXN1cmVkX21heF90ID0gdmFsdWUubWVhc3VyZWRfbWF4X3RlbXApID09PSBudWxsIHx8IF92YWx1ZSRtZWFzdXJlZF9tYXhfdCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3ZhbHVlJG1lYXN1cmVkX21heF90LnRvRml4ZWQoMSkKICAgICAgICB9OwogICAgICB9CiAgICB9KTsKICAgIHJldHVybiBvdXRwdXQ7CiAgfSwKICBnZXRNY3VUZW1wU2Vuc29yczogZnVuY3Rpb24gZ2V0TWN1VGVtcFNlbnNvcnMoc3RhdGUsIGdldHRlcnMpIHsKICAgIHZhciBjaGVja09iamVjdHMgPSBbJ3RlbXBlcmF0dXJlX3NlbnNvcicsICd0ZW1wZXJhdHVyZV9mYW4nXTsgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lCgogICAgdmFyIG91dHB1dCA9IFtdOwogICAgdmFyIG9iamVjdHMgPSBnZXR0ZXJzLmdldFByaW50ZXJDb25maWdPYmplY3RzKGNoZWNrT2JqZWN0cyk7CiAgICBPYmplY3Qua2V5cyhvYmplY3RzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgdmFyIHZhbHVlID0gb2JqZWN0c1trZXldOwogICAgICB2YXIgY2FzZUtleSA9IE9iamVjdC5rZXlzKHN0YXRlKS5maW5kKGZ1bmN0aW9uIChzdGF0ZV9rZXkpIHsKICAgICAgICByZXR1cm4gc3RhdGVfa2V5LnRvTG93ZXJDYXNlKCkgPT09IGtleS50b0xvd2VyQ2FzZSgpOwogICAgICB9KSB8fCAnJzsKCiAgICAgIGlmICgnc2Vuc29yX3R5cGUnIGluIHZhbHVlICYmIHZhbHVlLnNlbnNvcl90eXBlID09PSAndGVtcGVyYXR1cmVfbWN1JyAmJiAnc2Vuc29yX21jdScgaW4gdmFsdWUpIHsKICAgICAgICBvdXRwdXQucHVzaCh7CiAgICAgICAgICBrZXk6IGNhc2VLZXksCiAgICAgICAgICBzZXR0aW5nczogdmFsdWUsCiAgICAgICAgICBvYmplY3Q6IGNhc2VLZXkgaW4gc3RhdGUgPyBzdGF0ZVtjYXNlS2V5XSA6IHt9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIG91dHB1dDsKICB9LAogIGdldE1jdVRlbXBTZW5zb3I6IGZ1bmN0aW9uIGdldE1jdVRlbXBTZW5zb3Ioc3RhdGUsIGdldHRlcnMpIHsKICAgIHJldHVybiBmdW5jdGlvbiAobWN1TmFtZSkgewogICAgICB2YXIgb3V0cHV0ID0gbnVsbDsKICAgICAgdmFyIHNlbnNvcnMgPSBnZXR0ZXJzLmdldE1jdVRlbXBTZW5zb3JzOyAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUKCiAgICAgIHNlbnNvcnMuZm9yRWFjaChmdW5jdGlvbiAoc2Vuc29yKSB7CiAgICAgICAgdmFyIF9zZW5zb3Ikc2V0dGluZ3MsIF9zZW5zb3Ikb2JqZWN0OwoKICAgICAgICBpZiAoKChfc2Vuc29yJHNldHRpbmdzID0gc2Vuc29yLnNldHRpbmdzKSA9PT0gbnVsbCB8fCBfc2Vuc29yJHNldHRpbmdzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfc2Vuc29yJHNldHRpbmdzLnNlbnNvcl9tY3UpID09PSBtY3VOYW1lICYmIChfc2Vuc29yJG9iamVjdCA9IHNlbnNvci5vYmplY3QpICE9PSBudWxsICYmIF9zZW5zb3Ikb2JqZWN0ICE9PSB2b2lkIDAgJiYgX3NlbnNvciRvYmplY3QudGVtcGVyYXR1cmUpIHsKICAgICAgICAgIHZhciBfc2Vuc29yJG9iamVjdCRtZWFzdXIsIF9zZW5zb3Ikb2JqZWN0JG1lYXN1cjIsIF9zZW5zb3Ikb2JqZWN0JG1lYXN1cjMsIF9zZW5zb3Ikb2JqZWN0JG1lYXN1cjQ7CgogICAgICAgICAgb3V0cHV0ID0gewogICAgICAgICAgICB0ZW1wZXJhdHVyZTogc2Vuc29yLm9iamVjdC50ZW1wZXJhdHVyZS50b0ZpeGVkKDApLAogICAgICAgICAgICBtZWFzdXJlZF9taW5fdGVtcDogKF9zZW5zb3Ikb2JqZWN0JG1lYXN1ciA9IChfc2Vuc29yJG9iamVjdCRtZWFzdXIyID0gc2Vuc29yLm9iamVjdC5tZWFzdXJlZF9taW5fdGVtcCkgPT09IG51bGwgfHwgX3NlbnNvciRvYmplY3QkbWVhc3VyMiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3NlbnNvciRvYmplY3QkbWVhc3VyMi50b0ZpeGVkKDEpKSAhPT0gbnVsbCAmJiBfc2Vuc29yJG9iamVjdCRtZWFzdXIgIT09IHZvaWQgMCA/IF9zZW5zb3Ikb2JqZWN0JG1lYXN1ciA6IG51bGwsCiAgICAgICAgICAgIG1lYXN1cmVkX21heF90ZW1wOiAoX3NlbnNvciRvYmplY3QkbWVhc3VyMyA9IChfc2Vuc29yJG9iamVjdCRtZWFzdXI0ID0gc2Vuc29yLm9iamVjdC5tZWFzdXJlZF9tYXhfdGVtcCkgPT09IG51bGwgfHwgX3NlbnNvciRvYmplY3QkbWVhc3VyNCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3NlbnNvciRvYmplY3QkbWVhc3VyNC50b0ZpeGVkKDEpKSAhPT0gbnVsbCAmJiBfc2Vuc29yJG9iamVjdCRtZWFzdXIzICE9PSB2b2lkIDAgPyBfc2Vuc29yJG9iamVjdCRtZWFzdXIzIDogbnVsbAogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICByZXR1cm4gb3V0cHV0OwogICAgfTsKICB9LAogIGdldEJlZE1lc2hQcm9maWxlczogZnVuY3Rpb24gZ2V0QmVkTWVzaFByb2ZpbGVzKHN0YXRlKSB7CiAgICB2YXIgX3N0YXRlJGNvbmZpZ2ZpbGUxMzsKCiAgICB2YXIgcHJvZmlsZXMgPSBbXTsKICAgIHZhciBjdXJyZW50UHJvZmlsZSA9ICcnOwogICAgaWYgKHN0YXRlLmJlZF9tZXNoKSBjdXJyZW50UHJvZmlsZSA9IHN0YXRlLmJlZF9tZXNoLnByb2ZpbGVfbmFtZTsKCiAgICBpZiAoKF9zdGF0ZSRjb25maWdmaWxlMTMgPSBzdGF0ZS5jb25maWdmaWxlKSAhPT0gbnVsbCAmJiBfc3RhdGUkY29uZmlnZmlsZTEzICE9PSB2b2lkIDAgJiYgX3N0YXRlJGNvbmZpZ2ZpbGUxMy5jb25maWcpIHsKICAgICAgT2JqZWN0LmtleXMoc3RhdGUuY29uZmlnZmlsZS5jb25maWcpLmZpbHRlcihmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgcmV0dXJuIGtleS5zdGFydHNXaXRoKCdiZWRfbWVzaCAnKTsKICAgICAgfSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lCiAgICAgICAgdmFyIHZhbHVlID0gc3RhdGUuY29uZmlnZmlsZS5zZXR0aW5nc1trZXkudG9Mb3dlckNhc2UoKV07CiAgICAgICAgdmFyIG5hbWVTcGxpdCA9IGtleS5zcGxpdCgnICcpOwogICAgICAgIHZhciBwb2ludHMgPSBbXTsKCiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZS5wb2ludHMgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgICB2YWx1ZS5wb2ludHMuc3BsaXQoJ1xuJykuZm9yRWFjaChmdW5jdGlvbiAocm93KSB7CiAgICAgICAgICAgIGlmIChyb3cgIT09ICcnKSB7CiAgICAgICAgICAgICAgcm93LnNwbGl0KCcsICcpLmZvckVhY2goZnVuY3Rpb24gKGNvbCkgewogICAgICAgICAgICAgICAgcG9pbnRzLnB1c2gocGFyc2VGbG9hdChjb2wpKTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhbHVlLnBvaW50cy5mb3JFYWNoKGZ1bmN0aW9uIChyb3cpIHsKICAgICAgICAgICAgcG9pbnRzID0gcG9pbnRzLmNvbmNhdChyb3cpOwogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICB2YXIgbWluID0gTWF0aC5taW4uYXBwbHkoTWF0aCwgX3RvQ29uc3VtYWJsZUFycmF5KHBvaW50cykpOwogICAgICAgIHZhciBtYXggPSBNYXRoLm1heC5hcHBseShNYXRoLCBfdG9Db25zdW1hYmxlQXJyYXkocG9pbnRzKSk7CiAgICAgICAgcHJvZmlsZXMucHVzaCh7CiAgICAgICAgICBuYW1lOiBuYW1lU3BsaXRbMV0sCiAgICAgICAgICBkYXRhOiB2YWx1ZSwKICAgICAgICAgIHBvaW50czogcG9pbnRzLAogICAgICAgICAgbWluOiBtaW4sCiAgICAgICAgICBtYXg6IG1heCwKICAgICAgICAgIHZhcmlhbmNlOiBNYXRoLmFicyhtaW4gLSBtYXgpLAogICAgICAgICAgaXNfYWN0aXZlOiBjdXJyZW50UHJvZmlsZSA9PT0gbmFtZVNwbGl0WzFdCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQoKICAgIHJldHVybiBjYXNlSW5zZW5zaXRpdmVTb3J0KHByb2ZpbGVzLCAnbmFtZScpOwogIH0sCiAgZ2V0RXh0cnVkZVBvc3NpYmxlOiBmdW5jdGlvbiBnZXRFeHRydWRlUG9zc2libGUoc3RhdGUpIHsKICAgIHZhciBfc3RhdGUkdG9vbGhlYWQkZXh0cnUsIF9zdGF0ZSR0b29saGVhZDIsIF9zdGF0ZSRleHRydWRlck5hbWUkYywgX3N0YXRlJGV4dHJ1ZGVyTmFtZTsKCiAgICB2YXIgZXh0cnVkZXJOYW1lID0gKF9zdGF0ZSR0b29saGVhZCRleHRydSA9IChfc3RhdGUkdG9vbGhlYWQyID0gc3RhdGUudG9vbGhlYWQpID09PSBudWxsIHx8IF9zdGF0ZSR0b29saGVhZDIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9zdGF0ZSR0b29saGVhZDIuZXh0cnVkZXIpICE9PSBudWxsICYmIF9zdGF0ZSR0b29saGVhZCRleHRydSAhPT0gdm9pZCAwID8gX3N0YXRlJHRvb2xoZWFkJGV4dHJ1IDogJ2V4dHJ1ZGVyJzsKICAgIHJldHVybiAoX3N0YXRlJGV4dHJ1ZGVyTmFtZSRjID0gKF9zdGF0ZSRleHRydWRlck5hbWUgPSBzdGF0ZVtleHRydWRlck5hbWVdKSA9PT0gbnVsbCB8fCBfc3RhdGUkZXh0cnVkZXJOYW1lID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfc3RhdGUkZXh0cnVkZXJOYW1lLmNhbl9leHRydWRlKSAhPT0gbnVsbCAmJiBfc3RhdGUkZXh0cnVkZXJOYW1lJGMgIT09IHZvaWQgMCA/IF9zdGF0ZSRleHRydWRlck5hbWUkYyA6IGZhbHNlOwogIH0sCiAgZ2V0QmVkTWVzaFByb2ZpbGVOYW1lOiBmdW5jdGlvbiBnZXRCZWRNZXNoUHJvZmlsZU5hbWUoc3RhdGUpIHsKICAgIGlmICgnYmVkX21lc2gnIGluIHN0YXRlICYmICdwcm9maWxlX25hbWUnIGluIHN0YXRlLmJlZF9tZXNoKSByZXR1cm4gc3RhdGUuYmVkX21lc2gucHJvZmlsZV9uYW1lOwogICAgcmV0dXJuICcnOwogIH0sCiAgZ2V0TWF4VGVtcDogZnVuY3Rpb24gZ2V0TWF4VGVtcChzdGF0ZSkgewogICAgdmFyIF9zdGF0ZSRoZWF0ZXJzMywgX3N0YXRlJGhlYXRlcnMzJGF2YWlsOwoKICAgIHZhciBtYXh0ZW1wID0gMDsKICAgIChfc3RhdGUkaGVhdGVyczMgPSBzdGF0ZS5oZWF0ZXJzKSA9PT0gbnVsbCB8fCBfc3RhdGUkaGVhdGVyczMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IChfc3RhdGUkaGVhdGVyczMkYXZhaWwgPSBfc3RhdGUkaGVhdGVyczMuYXZhaWxhYmxlX3NlbnNvcnMpID09PSBudWxsIHx8IF9zdGF0ZSRoZWF0ZXJzMyRhdmFpbCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3N0YXRlJGhlYXRlcnMzJGF2YWlsLmZvckVhY2goZnVuY3Rpb24gKHNlbnNvck5hbWUpIHsKICAgICAgdmFyIF9zdGF0ZSRjb25maWdmaWxlMTQ7CgogICAgICB2YXIgc2V0dGluZ3MgPSAoX3N0YXRlJGNvbmZpZ2ZpbGUxNCA9IHN0YXRlLmNvbmZpZ2ZpbGUpID09PSBudWxsIHx8IF9zdGF0ZSRjb25maWdmaWxlMTQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9zdGF0ZSRjb25maWdmaWxlMTQuc2V0dGluZ3Nbc2Vuc29yTmFtZV07CiAgICAgIGlmIChzZXR0aW5ncyAmJiAnbWF4X3RlbXAnIGluIHNldHRpbmdzICYmIE1hdGgucm91bmQoc2V0dGluZ3MubWF4X3RlbXApID4gbWF4dGVtcCAmJiBNYXRoLnJvdW5kKHNldHRpbmdzLm1heF90ZW1wKSA8IDEwMDAwKSBtYXh0ZW1wID0gTWF0aC5yb3VuZChzZXR0aW5ncy5tYXhfdGVtcCk7CiAgICB9KTsKICAgIHJldHVybiBtYXh0ZW1wID4gMCA/IG1heHRlbXAgKyAxMCA6IDMwMDsKICB9LAogIGV4aXN0UHJpbnRlckNvbmZpZzogZnVuY3Rpb24gZXhpc3RQcmludGVyQ29uZmlnKHN0YXRlKSB7CiAgICB2YXIgX3N0YXRlJGNvbmZpZ2ZpbGUxNTsKCiAgICBpZiAoKF9zdGF0ZSRjb25maWdmaWxlMTUgPSBzdGF0ZS5jb25maWdmaWxlKSAhPT0gbnVsbCAmJiBfc3RhdGUkY29uZmlnZmlsZTE1ICE9PSB2b2lkIDAgJiYgX3N0YXRlJGNvbmZpZ2ZpbGUxNS5jb25maWcpIHJldHVybiBPYmplY3Qua2V5cyhzdGF0ZS5jb25maWdmaWxlLmNvbmZpZykubGVuZ3RoID4gMDsKICAgIHJldHVybiBmYWxzZTsKICB9LAogIGNoZWNrQ29uZmlnOiBmdW5jdGlvbiBjaGVja0NvbmZpZyhzdGF0ZSkgewogICAgcmV0dXJuIGZ1bmN0aW9uIChjb25maWdOYW1lKSB7CiAgICAgIGlmICghc3RhdGUuY29uZmlnZmlsZS5jb25maWcpIHJldHVybiBmYWxzZTsKICAgICAgdmFyIGNvbmZpZ09iamVjdHMgPSBPYmplY3Qua2V5cyhzdGF0ZS5jb25maWdmaWxlLmNvbmZpZyk7CiAgICAgIHJldHVybiBjb25maWdPYmplY3RzLmZpbmRJbmRleChmdW5jdGlvbiAobW9kdWxlKSB7CiAgICAgICAgcmV0dXJuIG1vZHVsZS50b0xvd2VyQ2FzZSgpID09PSBjb25maWdOYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAgIH0pICE9PSAtMTsKICAgIH07CiAgfSwKICBjaGVja05lY2Vzc2FyeUNvbmZpZzogZnVuY3Rpb24gY2hlY2tOZWNlc3NhcnlDb25maWcoc3RhdGUsIGdldHRlcnMpIHsKICAgIHZhciBtaXNzaW5nTW9kdWxlcyA9IFtdOwogICAgY2hlY2tLbGlwcGVyQ29uZmlnTW9kdWxlcy5mb3JFYWNoKGZ1bmN0aW9uIChtb2R1bGUpIHsKICAgICAgaWYgKCFnZXR0ZXJzLmNoZWNrQ29uZmlnKG1vZHVsZSkpIG1pc3NpbmdNb2R1bGVzLnB1c2gobW9kdWxlKTsKICAgIH0pOwogICAgaWYgKCFnZXR0ZXJzLmNoZWNrQ29uZmlnKCdkaXNwbGF5JykgJiYgIWdldHRlcnMuY2hlY2tDb25maWcoJ2Rpc3BsYXlfc3RhdHVzJykpIG1pc3NpbmdNb2R1bGVzLnB1c2goJ2Rpc3BsYXlfc3RhdHVzJyk7CiAgICByZXR1cm4gbWlzc2luZ01vZHVsZXM7CiAgfSwKICBnZXRFc3RpbWF0ZWRUaW1lRmlsZTogZnVuY3Rpb24gZ2V0RXN0aW1hdGVkVGltZUZpbGUoc3RhdGUsIGdldHRlcnMpIHsKICAgIGlmICgncHJpbnRfc3RhdHMnIGluIHN0YXRlICYmICdwcmludF9kdXJhdGlvbicgaW4gc3RhdGUucHJpbnRfc3RhdHMgJiYgc3RhdGUucHJpbnRfc3RhdHMucHJpbnRfZHVyYXRpb24gPiAwICYmIGdldHRlcnMuZ2V0UHJpbnRQZXJjZW50ID4gMCkgewogICAgICByZXR1cm4gKHN0YXRlLnByaW50X3N0YXRzLnByaW50X2R1cmF0aW9uIC8gZ2V0dGVycy5nZXRQcmludFBlcmNlbnQgLSBzdGF0ZS5wcmludF9zdGF0cy5wcmludF9kdXJhdGlvbikudG9GaXhlZCgwKTsKICAgIH0KCiAgICByZXR1cm4gMDsKICB9LAogIGdldEVzdGltYXRlZFRpbWVGaWxhbWVudDogZnVuY3Rpb24gZ2V0RXN0aW1hdGVkVGltZUZpbGFtZW50KHN0YXRlKSB7CiAgICBpZiAoJ3ByaW50X3N0YXRzJyBpbiBzdGF0ZSAmJiAncHJpbnRfZHVyYXRpb24nIGluIHN0YXRlLnByaW50X3N0YXRzICYmICdmaWxhbWVudF91c2VkJyBpbiBzdGF0ZS5wcmludF9zdGF0cyAmJiAnY3VycmVudF9maWxlJyBpbiBzdGF0ZSAmJiAnZmlsYW1lbnRfdG90YWwnIGluIHN0YXRlLmN1cnJlbnRfZmlsZSAmJiBzdGF0ZS5wcmludF9zdGF0cy5wcmludF9kdXJhdGlvbiA+IDAgJiYgc3RhdGUuY3VycmVudF9maWxlLmZpbGFtZW50X3RvdGFsID4gMCAmJiBzdGF0ZS5jdXJyZW50X2ZpbGUuZmlsYW1lbnRfdG90YWwgPiBzdGF0ZS5wcmludF9zdGF0cy5maWxhbWVudF91c2VkKSB7CiAgICAgIHJldHVybiAoc3RhdGUucHJpbnRfc3RhdHMucHJpbnRfZHVyYXRpb24gLyAoc3RhdGUucHJpbnRfc3RhdHMuZmlsYW1lbnRfdXNlZCAvIHN0YXRlLmN1cnJlbnRfZmlsZS5maWxhbWVudF90b3RhbCkgLSBzdGF0ZS5wcmludF9zdGF0cy5wcmludF9kdXJhdGlvbikudG9GaXhlZCgwKTsKICAgIH0KCiAgICByZXR1cm4gMDsKICB9LAogIGdldEVzdGltYXRlZFRpbWVTbGljZXI6IGZ1bmN0aW9uIGdldEVzdGltYXRlZFRpbWVTbGljZXIoc3RhdGUpIHsKICAgIGlmICgncHJpbnRfc3RhdHMnIGluIHN0YXRlICYmICdwcmludF9kdXJhdGlvbicgaW4gc3RhdGUucHJpbnRfc3RhdHMgJiYgJ2N1cnJlbnRfZmlsZScgaW4gc3RhdGUgJiYgJ2VzdGltYXRlZF90aW1lJyBpbiBzdGF0ZS5jdXJyZW50X2ZpbGUgJiYgc3RhdGUucHJpbnRfc3RhdHMucHJpbnRfZHVyYXRpb24gPiAwICYmIHN0YXRlLmN1cnJlbnRfZmlsZS5lc3RpbWF0ZWRfdGltZSA+IDAgJiYgc3RhdGUuY3VycmVudF9maWxlLmVzdGltYXRlZF90aW1lID4gc3RhdGUucHJpbnRfc3RhdHMucHJpbnRfZHVyYXRpb24pIHsKICAgICAgcmV0dXJuIChzdGF0ZS5jdXJyZW50X2ZpbGUuZXN0aW1hdGVkX3RpbWUgLSBzdGF0ZS5wcmludF9zdGF0cy5wcmludF9kdXJhdGlvbikudG9GaXhlZCgwKTsKICAgIH0KCiAgICByZXR1cm4gMDsKICB9LAogIGdldEVzdGltYXRlZFRpbWVBdmc6IGZ1bmN0aW9uIGdldEVzdGltYXRlZFRpbWVBdmcoc3RhdGUsIGdldHRlcnMsIHJvb3RTdGF0ZSkgewogICAgdmFyIF9yb290U3RhdGUkZ3VpJGdlbmVyYSwgX3Jvb3RTdGF0ZSRndWkyLCBfcm9vdFN0YXRlJGd1aTIkZ2VuZXIsIF9yb290U3RhdGUkZ3VpMiRnZW5lcjIsIF9yb290U3RhdGUkZ3VpJGdlbmVyYTIsIF9yb290U3RhdGUkZ3VpMywgX3Jvb3RTdGF0ZSRndWkzJGdlbmVyLCBfcm9vdFN0YXRlJGd1aTMkZ2VuZXIyOwoKICAgIHZhciB0aW1lID0gMDsKICAgIHZhciB0aW1lQ291bnQgPSAwOwogICAgdmFyIGJvb2xGaWxlQ2FsYyA9IChfcm9vdFN0YXRlJGd1aSRnZW5lcmEgPSAoX3Jvb3RTdGF0ZSRndWkyID0gcm9vdFN0YXRlLmd1aSkgPT09IG51bGwgfHwgX3Jvb3RTdGF0ZSRndWkyID09PSB2b2lkIDAgPyB2b2lkIDAgOiAoX3Jvb3RTdGF0ZSRndWkyJGdlbmVyID0gX3Jvb3RTdGF0ZSRndWkyLmdlbmVyYWwpID09PSBudWxsIHx8IF9yb290U3RhdGUkZ3VpMiRnZW5lciA9PT0gdm9pZCAwID8gdm9pZCAwIDogKF9yb290U3RhdGUkZ3VpMiRnZW5lcjIgPSBfcm9vdFN0YXRlJGd1aTIkZ2VuZXIuY2FsY0VzdGltYXRlVGltZSkgPT09IG51bGwgfHwgX3Jvb3RTdGF0ZSRndWkyJGdlbmVyMiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3Jvb3RTdGF0ZSRndWkyJGdlbmVyMi5pbmNsdWRlcygnZmlsZScpKSAhPT0gbnVsbCAmJiBfcm9vdFN0YXRlJGd1aSRnZW5lcmEgIT09IHZvaWQgMCA/IF9yb290U3RhdGUkZ3VpJGdlbmVyYSA6IGZhbHNlOwogICAgdmFyIGJvb2xGaWxhbWVudENhbGMgPSAoX3Jvb3RTdGF0ZSRndWkkZ2VuZXJhMiA9IChfcm9vdFN0YXRlJGd1aTMgPSByb290U3RhdGUuZ3VpKSA9PT0gbnVsbCB8fCBfcm9vdFN0YXRlJGd1aTMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IChfcm9vdFN0YXRlJGd1aTMkZ2VuZXIgPSBfcm9vdFN0YXRlJGd1aTMuZ2VuZXJhbCkgPT09IG51bGwgfHwgX3Jvb3RTdGF0ZSRndWkzJGdlbmVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiAoX3Jvb3RTdGF0ZSRndWkzJGdlbmVyMiA9IF9yb290U3RhdGUkZ3VpMyRnZW5lci5jYWxjRXN0aW1hdGVUaW1lKSA9PT0gbnVsbCB8fCBfcm9vdFN0YXRlJGd1aTMkZ2VuZXIyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfcm9vdFN0YXRlJGd1aTMkZ2VuZXIyLmluY2x1ZGVzKCdmaWxhbWVudCcpKSAhPT0gbnVsbCAmJiBfcm9vdFN0YXRlJGd1aSRnZW5lcmEyICE9PSB2b2lkIDAgPyBfcm9vdFN0YXRlJGd1aSRnZW5lcmEyIDogZmFsc2U7CgogICAgaWYgKGJvb2xGaWxlQ2FsYyAmJiBnZXR0ZXJzLmdldEVzdGltYXRlZFRpbWVGaWxlID4gMCkgewogICAgICB0aW1lICs9IHBhcnNlSW50KGdldHRlcnMuZ2V0RXN0aW1hdGVkVGltZUZpbGUpOwogICAgICB0aW1lQ291bnQrKzsKICAgIH0KCiAgICBpZiAoYm9vbEZpbGFtZW50Q2FsYyAmJiBnZXR0ZXJzLmdldEVzdGltYXRlZFRpbWVGaWxhbWVudCA+IDApIHsKICAgICAgdGltZSArPSBwYXJzZUludChnZXR0ZXJzLmdldEVzdGltYXRlZFRpbWVGaWxhbWVudCk7CiAgICAgIHRpbWVDb3VudCsrOwogICAgfQoKICAgIGlmICh0aW1lICYmIHRpbWVDb3VudCkgcmV0dXJuIHRpbWUgLyB0aW1lQ291bnQ7CiAgICByZXR1cm4gMDsKICB9LAogIGdldEVzdGltYXRlZFRpbWVFVEE6IGZ1bmN0aW9uIGdldEVzdGltYXRlZFRpbWVFVEEoc3RhdGUsIGdldHRlcnMsIHJvb3RTdGF0ZSkgewogICAgdmFyIF9yb290U3RhdGUkZ3VpJGdlbmVyYTMsIF9yb290U3RhdGUkZ3VpNCwgX3Jvb3RTdGF0ZSRndWk0JGdlbmVyLCBfcm9vdFN0YXRlJGd1aTQkZ2VuZXIyLCBfcm9vdFN0YXRlJGd1aSRnZW5lcmE0LCBfcm9vdFN0YXRlJGd1aTUsIF9yb290U3RhdGUkZ3VpNSRnZW5lciwgX3Jvb3RTdGF0ZSRndWk1JGdlbmVyMiwgX3Jvb3RTdGF0ZSRndWkkZ2VuZXJhNSwgX3Jvb3RTdGF0ZSRndWk2LCBfcm9vdFN0YXRlJGd1aTYkZ2VuZXIsIF9yb290U3RhdGUkZ3VpNiRnZW5lcjI7CgogICAgdmFyIHRpbWUgPSAwOwogICAgdmFyIHRpbWVDb3VudCA9IDA7CiAgICB2YXIgYm9vbEZpbGVDYWxjID0gKF9yb290U3RhdGUkZ3VpJGdlbmVyYTMgPSAoX3Jvb3RTdGF0ZSRndWk0ID0gcm9vdFN0YXRlLmd1aSkgPT09IG51bGwgfHwgX3Jvb3RTdGF0ZSRndWk0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiAoX3Jvb3RTdGF0ZSRndWk0JGdlbmVyID0gX3Jvb3RTdGF0ZSRndWk0LmdlbmVyYWwpID09PSBudWxsIHx8IF9yb290U3RhdGUkZ3VpNCRnZW5lciA9PT0gdm9pZCAwID8gdm9pZCAwIDogKF9yb290U3RhdGUkZ3VpNCRnZW5lcjIgPSBfcm9vdFN0YXRlJGd1aTQkZ2VuZXIuY2FsY0V0YVRpbWUpID09PSBudWxsIHx8IF9yb290U3RhdGUkZ3VpNCRnZW5lcjIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9yb290U3RhdGUkZ3VpNCRnZW5lcjIuaW5jbHVkZXMoJ2ZpbGUnKSkgIT09IG51bGwgJiYgX3Jvb3RTdGF0ZSRndWkkZ2VuZXJhMyAhPT0gdm9pZCAwID8gX3Jvb3RTdGF0ZSRndWkkZ2VuZXJhMyA6IGZhbHNlOwogICAgdmFyIGJvb2xGaWxhbWVudENhbGMgPSAoX3Jvb3RTdGF0ZSRndWkkZ2VuZXJhNCA9IChfcm9vdFN0YXRlJGd1aTUgPSByb290U3RhdGUuZ3VpKSA9PT0gbnVsbCB8fCBfcm9vdFN0YXRlJGd1aTUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IChfcm9vdFN0YXRlJGd1aTUkZ2VuZXIgPSBfcm9vdFN0YXRlJGd1aTUuZ2VuZXJhbCkgPT09IG51bGwgfHwgX3Jvb3RTdGF0ZSRndWk1JGdlbmVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiAoX3Jvb3RTdGF0ZSRndWk1JGdlbmVyMiA9IF9yb290U3RhdGUkZ3VpNSRnZW5lci5jYWxjRXRhVGltZSkgPT09IG51bGwgfHwgX3Jvb3RTdGF0ZSRndWk1JGdlbmVyMiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3Jvb3RTdGF0ZSRndWk1JGdlbmVyMi5pbmNsdWRlcygnZmlsYW1lbnQnKSkgIT09IG51bGwgJiYgX3Jvb3RTdGF0ZSRndWkkZ2VuZXJhNCAhPT0gdm9pZCAwID8gX3Jvb3RTdGF0ZSRndWkkZ2VuZXJhNCA6IGZhbHNlOwogICAgdmFyIGJvb2xTbGljZXJDYWxjID0gKF9yb290U3RhdGUkZ3VpJGdlbmVyYTUgPSAoX3Jvb3RTdGF0ZSRndWk2ID0gcm9vdFN0YXRlLmd1aSkgPT09IG51bGwgfHwgX3Jvb3RTdGF0ZSRndWk2ID09PSB2b2lkIDAgPyB2b2lkIDAgOiAoX3Jvb3RTdGF0ZSRndWk2JGdlbmVyID0gX3Jvb3RTdGF0ZSRndWk2LmdlbmVyYWwpID09PSBudWxsIHx8IF9yb290U3RhdGUkZ3VpNiRnZW5lciA9PT0gdm9pZCAwID8gdm9pZCAwIDogKF9yb290U3RhdGUkZ3VpNiRnZW5lcjIgPSBfcm9vdFN0YXRlJGd1aTYkZ2VuZXIuY2FsY0V0YVRpbWUpID09PSBudWxsIHx8IF9yb290U3RhdGUkZ3VpNiRnZW5lcjIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9yb290U3RhdGUkZ3VpNiRnZW5lcjIuaW5jbHVkZXMoJ3NsaWNlcicpKSAhPT0gbnVsbCAmJiBfcm9vdFN0YXRlJGd1aSRnZW5lcmE1ICE9PSB2b2lkIDAgPyBfcm9vdFN0YXRlJGd1aSRnZW5lcmE1IDogZmFsc2U7CgogICAgaWYgKGJvb2xGaWxlQ2FsYyAmJiBnZXR0ZXJzLmdldEVzdGltYXRlZFRpbWVGaWxlID4gMCkgewogICAgICB0aW1lICs9IHBhcnNlSW50KGdldHRlcnMuZ2V0RXN0aW1hdGVkVGltZUZpbGUpOwogICAgICB0aW1lQ291bnQrKzsKICAgIH0KCiAgICBpZiAoYm9vbEZpbGFtZW50Q2FsYyAmJiBnZXR0ZXJzLmdldEVzdGltYXRlZFRpbWVGaWxhbWVudCA+IDApIHsKICAgICAgdGltZSArPSBwYXJzZUludChnZXR0ZXJzLmdldEVzdGltYXRlZFRpbWVGaWxhbWVudCk7CiAgICAgIHRpbWVDb3VudCsrOwogICAgfQoKICAgIGlmIChib29sU2xpY2VyQ2FsYyAmJiBnZXR0ZXJzLmdldEVzdGltYXRlZFRpbWVTbGljZXIgPiAwKSB7CiAgICAgIHRpbWUgKz0gcGFyc2VJbnQoZ2V0dGVycy5nZXRFc3RpbWF0ZWRUaW1lU2xpY2VyKTsKICAgICAgdGltZUNvdW50Kys7CiAgICB9CgogICAgaWYgKHRpbWUgJiYgdGltZUNvdW50KSByZXR1cm4gRGF0ZS5ub3coKSArIHRpbWUgLyB0aW1lQ291bnQgKiAxMDAwOwogICAgcmV0dXJuIDA7CiAgfQp9Ow=="},null]}