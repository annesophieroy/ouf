{"remainingRequest":"/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/src/components/inputs/MacroButton.vue?vue&type=style&index=0&id=20c7e0e8&scoped=true&lang=css&","dependencies":[{"path":"/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/src/components/inputs/MacroButton.vue","mtime":1644874918000},{"path":"/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/node_modules/@vue/cli-service/node_modules/css-loader/dist/cjs.js","mtime":1645990066541},{"path":"/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/node_modules/@vue/cli-service/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1645990070825},{"path":"/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/node_modules/postcss-loader/src/index.js","mtime":1645990067674},{"path":"/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/node_modules/cache-loader/dist/cjs.js","mtime":1645990064605},{"path":"/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1645990069130}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci5idG5NYWNyb01lbnUgewogICAgYm9yZGVyLXRvcC1sZWZ0LXJhZGl1czogMDsKICAgIGJvcmRlci1ib3R0b20tbGVmdC1yYWRpdXM6IDA7Cn0KCi5tYWNyb1dpdGhQYXJhbWV0ZXJzIHsKICAgIGJvcmRlci10b3AtcmlnaHQtcmFkaXVzOiAwOwogICAgYm9yZGVyLWJvdHRvbS1yaWdodC1yYWRpdXM6IDA7Cn0K"},{"version":3,"sources":["MacroButton.vue"],"names":[],"mappings":";AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"MacroButton.vue","sourceRoot":"src/components/inputs","sourcesContent":["<style scoped>\n    .btnMacroMenu {\n        border-top-left-radius: 0;\n        border-bottom-left-radius: 0;\n    }\n\n    .macroWithParameters {\n        border-top-right-radius: 0;\n        border-bottom-right-radius: 0;\n    }\n</style>\n\n<template>\n    <v-item-group class=\"d-inline-block\">\n        <v-btn\n            small\n            :color=\"color\"\n            :class=\"paramArray.length ? 'macroWithParameters' : ''\"\n            :loading=\"loadings.includes('macro_'+macro.name)\"\n            @click=\"doSendMacro(macro.name)\">\n            {{ macro.name.replace(/_/g, \" \") }}\n        </v-btn>\n        <template v-if=\"paramArray.length\">\n            <v-menu offset-y :close-on-content-click=\"false\">\n                <template v-slot:activator=\"{ on, attrs }\">\n                    <v-btn\n                        small\n                        :color=\"color\"\n                        v-bind=\"attrs\"\n                        v-on=\"on\"\n                        class=\"minwidth-0 px-1 btnMacroMenu\"\n                    >\n                        <v-icon>mdi-menu-down</v-icon>\n                    </v-btn>\n                </template>\n                <v-card max-width=\"200\">\n                    <v-card-text class=\"py-2\">\n                        <v-row v-for=\"(name, key) in paramArray\" :key=\"'param_'+key\" class=\"my-2\">\n                            <v-col class=\"py-0\">\n                                <v-text-field\n                                    :label=\"name\"\n                                    v-model=\"params[name].value\"\n                                    :placeholder=\"params[name].default\"\n                                    :persistent-placeholder=\"true\"\n                                    hide-details\n                                    outlined\n                                    dense\n                                    clearable\n                                    clear-icon=\"mdi-refresh\"\n                                    @keyup.enter=\"sendWithParams\"\n                                ></v-text-field>\n                            </v-col>\n                        </v-row>\n                        <v-row class=\"my-2\">\n                            <v-col class=\"py-0\">\n                                <v-btn color=\"primary\" class=\"text-uppercase\" block @click=\"sendWithParams\">\n                                    {{ $t('Panels.MacrosPanel.Send') }}\n                                </v-btn>\n                            </v-col>\n                        </v-row>\n                    </v-card-text>\n                </v-card>\n            </v-menu>\n        </template>\n    </v-item-group>\n</template>\n\n<script lang=\"ts\">\nimport Component from 'vue-class-component'\nimport {Mixins, Prop, Watch} from 'vue-property-decorator'\nimport BaseMixin from '@/components/mixins/base'\nimport {GuiMacrosStateMacrogroupMacro} from '@/store/gui/macros/types'\n\ninterface param {\n    type: 'int' | 'double' | 'string' | null,\n    default: string | number | null\n    value: string | number | null\n}\n\ninterface params {\n    [key: string]: param\n}\n\n@Component\nexport default class MacroButton extends Mixins(BaseMixin) {\n    private paramArray: string[] = []\n    private params: params = {}\n\n    @Prop({ required: true }) readonly macro!: GuiMacrosStateMacrogroupMacro\n    @Prop({ default: 'primary' }) readonly color!: string\n\n    get klipperMacro() {\n        return this.$store.getters['printer/getMacro'](this.macro.name)\n    }\n\n    @Watch('klipperMacro')\n    klipperMacroChange() {\n        this.refreshParams()\n    }\n\n    refreshParams() {\n        this.paramArray.splice(0, this.paramArray.length)\n        this.params = {}\n\n        if (this.klipperMacro.params !== null) {\n            Object.keys(this.klipperMacro.params).forEach((name: string) => {\n                if (!name.startsWith('_')) {\n                    this.paramArray.push(name)\n                    this.params[name] = {\n                        type: this.klipperMacro.params[name].type,\n                        default: this.klipperMacro.params[name].default,\n                        value: ''\n                    }\n                }\n            })\n        }\n    }\n\n    doSendMacro(gcode: string) {\n        this.$store.dispatch('server/addEvent', { message: gcode, type: 'command' })\n        this.$socket.emit('printer.gcode.script', { script: gcode }, { loading: 'macro_'+gcode })\n    }\n\n    sendWithParams() {\n        let params: string[] = []\n        this.paramArray.forEach((paramname: string) => {\n            if (this.params[paramname].value !== null && this.params[paramname].value !== '')\n                params.push(paramname+'='+this.params[paramname].value)\n        })\n\n        const gcode = this.macro.name + ' ' +params.join(' ')\n        this.doSendMacro(gcode)\n    }\n\n    mounted(){\n        this.refreshParams()\n    }\n}\n</script>"]}]}