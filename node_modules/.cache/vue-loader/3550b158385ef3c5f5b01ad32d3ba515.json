{"remainingRequest":"/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/src/components/inputs/MacroButton.vue?vue&type=script&lang=ts&","dependencies":[{"path":"/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/src/components/inputs/MacroButton.vue","mtime":1644874918000},{"path":"/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/node_modules/cache-loader/dist/cjs.js","mtime":1645990064605},{"path":"/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/node_modules/babel-loader/lib/index.js","mtime":1645990067759},{"path":"/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/node_modules/ts-loader/index.js","mtime":1645990068168},{"path":"/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/node_modules/cache-loader/dist/cjs.js","mtime":1645990064605},{"path":"/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1645990069130}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgppbXBvcnQgQ29tcG9uZW50IGZyb20gJ3Z1ZS1jbGFzcy1jb21wb25lbnQnCmltcG9ydCB7TWl4aW5zLCBQcm9wLCBXYXRjaH0gZnJvbSAndnVlLXByb3BlcnR5LWRlY29yYXRvcicKaW1wb3J0IEJhc2VNaXhpbiBmcm9tICdAL2NvbXBvbmVudHMvbWl4aW5zL2Jhc2UnCmltcG9ydCB7R3VpTWFjcm9zU3RhdGVNYWNyb2dyb3VwTWFjcm99IGZyb20gJ0Avc3RvcmUvZ3VpL21hY3Jvcy90eXBlcycKCmludGVyZmFjZSBwYXJhbSB7CiAgICB0eXBlOiAnaW50JyB8ICdkb3VibGUnIHwgJ3N0cmluZycgfCBudWxsLAogICAgZGVmYXVsdDogc3RyaW5nIHwgbnVtYmVyIHwgbnVsbAogICAgdmFsdWU6IHN0cmluZyB8IG51bWJlciB8IG51bGwKfQoKaW50ZXJmYWNlIHBhcmFtcyB7CiAgICBba2V5OiBzdHJpbmddOiBwYXJhbQp9CgpAQ29tcG9uZW50CmV4cG9ydCBkZWZhdWx0IGNsYXNzIE1hY3JvQnV0dG9uIGV4dGVuZHMgTWl4aW5zKEJhc2VNaXhpbikgewogICAgcHJpdmF0ZSBwYXJhbUFycmF5OiBzdHJpbmdbXSA9IFtdCiAgICBwcml2YXRlIHBhcmFtczogcGFyYW1zID0ge30KCiAgICBAUHJvcCh7IHJlcXVpcmVkOiB0cnVlIH0pIHJlYWRvbmx5IG1hY3JvITogR3VpTWFjcm9zU3RhdGVNYWNyb2dyb3VwTWFjcm8KICAgIEBQcm9wKHsgZGVmYXVsdDogJ3ByaW1hcnknIH0pIHJlYWRvbmx5IGNvbG9yITogc3RyaW5nCgogICAgZ2V0IGtsaXBwZXJNYWNybygpIHsKICAgICAgICByZXR1cm4gdGhpcy4kc3RvcmUuZ2V0dGVyc1sncHJpbnRlci9nZXRNYWNybyddKHRoaXMubWFjcm8ubmFtZSkKICAgIH0KCiAgICBAV2F0Y2goJ2tsaXBwZXJNYWNybycpCiAgICBrbGlwcGVyTWFjcm9DaGFuZ2UoKSB7CiAgICAgICAgdGhpcy5yZWZyZXNoUGFyYW1zKCkKICAgIH0KCiAgICByZWZyZXNoUGFyYW1zKCkgewogICAgICAgIHRoaXMucGFyYW1BcnJheS5zcGxpY2UoMCwgdGhpcy5wYXJhbUFycmF5Lmxlbmd0aCkKICAgICAgICB0aGlzLnBhcmFtcyA9IHt9CgogICAgICAgIGlmICh0aGlzLmtsaXBwZXJNYWNyby5wYXJhbXMgIT09IG51bGwpIHsKICAgICAgICAgICAgT2JqZWN0LmtleXModGhpcy5rbGlwcGVyTWFjcm8ucGFyYW1zKS5mb3JFYWNoKChuYW1lOiBzdHJpbmcpID0+IHsKICAgICAgICAgICAgICAgIGlmICghbmFtZS5zdGFydHNXaXRoKCdfJykpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnBhcmFtQXJyYXkucHVzaChuYW1lKQogICAgICAgICAgICAgICAgICAgIHRoaXMucGFyYW1zW25hbWVdID0gewogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiB0aGlzLmtsaXBwZXJNYWNyby5wYXJhbXNbbmFtZV0udHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogdGhpcy5rbGlwcGVyTWFjcm8ucGFyYW1zW25hbWVdLmRlZmF1bHQsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiAnJwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICB9CiAgICB9CgogICAgZG9TZW5kTWFjcm8oZ2NvZGU6IHN0cmluZykgewogICAgICAgIHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdzZXJ2ZXIvYWRkRXZlbnQnLCB7IG1lc3NhZ2U6IGdjb2RlLCB0eXBlOiAnY29tbWFuZCcgfSkKICAgICAgICB0aGlzLiRzb2NrZXQuZW1pdCgncHJpbnRlci5nY29kZS5zY3JpcHQnLCB7IHNjcmlwdDogZ2NvZGUgfSwgeyBsb2FkaW5nOiAnbWFjcm9fJytnY29kZSB9KQogICAgfQoKICAgIHNlbmRXaXRoUGFyYW1zKCkgewogICAgICAgIGxldCBwYXJhbXM6IHN0cmluZ1tdID0gW10KICAgICAgICB0aGlzLnBhcmFtQXJyYXkuZm9yRWFjaCgocGFyYW1uYW1lOiBzdHJpbmcpID0+IHsKICAgICAgICAgICAgaWYgKHRoaXMucGFyYW1zW3BhcmFtbmFtZV0udmFsdWUgIT09IG51bGwgJiYgdGhpcy5wYXJhbXNbcGFyYW1uYW1lXS52YWx1ZSAhPT0gJycpCiAgICAgICAgICAgICAgICBwYXJhbXMucHVzaChwYXJhbW5hbWUrJz0nK3RoaXMucGFyYW1zW3BhcmFtbmFtZV0udmFsdWUpCiAgICAgICAgfSkKCiAgICAgICAgY29uc3QgZ2NvZGUgPSB0aGlzLm1hY3JvLm5hbWUgKyAnICcgK3BhcmFtcy5qb2luKCcgJykKICAgICAgICB0aGlzLmRvU2VuZE1hY3JvKGdjb2RlKQogICAgfQoKICAgIG1vdW50ZWQoKXsKICAgICAgICB0aGlzLnJlZnJlc2hQYXJhbXMoKQogICAgfQp9Cg=="},{"version":3,"sources":["MacroButton.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"MacroButton.vue","sourceRoot":"src/components/inputs","sourcesContent":["<style scoped>\n    .btnMacroMenu {\n        border-top-left-radius: 0;\n        border-bottom-left-radius: 0;\n    }\n\n    .macroWithParameters {\n        border-top-right-radius: 0;\n        border-bottom-right-radius: 0;\n    }\n</style>\n\n<template>\n    <v-item-group class=\"d-inline-block\">\n        <v-btn\n            small\n            :color=\"color\"\n            :class=\"paramArray.length ? 'macroWithParameters' : ''\"\n            :loading=\"loadings.includes('macro_'+macro.name)\"\n            @click=\"doSendMacro(macro.name)\">\n            {{ macro.name.replace(/_/g, \" \") }}\n        </v-btn>\n        <template v-if=\"paramArray.length\">\n            <v-menu offset-y :close-on-content-click=\"false\">\n                <template v-slot:activator=\"{ on, attrs }\">\n                    <v-btn\n                        small\n                        :color=\"color\"\n                        v-bind=\"attrs\"\n                        v-on=\"on\"\n                        class=\"minwidth-0 px-1 btnMacroMenu\"\n                    >\n                        <v-icon>mdi-menu-down</v-icon>\n                    </v-btn>\n                </template>\n                <v-card max-width=\"200\">\n                    <v-card-text class=\"py-2\">\n                        <v-row v-for=\"(name, key) in paramArray\" :key=\"'param_'+key\" class=\"my-2\">\n                            <v-col class=\"py-0\">\n                                <v-text-field\n                                    :label=\"name\"\n                                    v-model=\"params[name].value\"\n                                    :placeholder=\"params[name].default\"\n                                    :persistent-placeholder=\"true\"\n                                    hide-details\n                                    outlined\n                                    dense\n                                    clearable\n                                    clear-icon=\"mdi-refresh\"\n                                    @keyup.enter=\"sendWithParams\"\n                                ></v-text-field>\n                            </v-col>\n                        </v-row>\n                        <v-row class=\"my-2\">\n                            <v-col class=\"py-0\">\n                                <v-btn color=\"primary\" class=\"text-uppercase\" block @click=\"sendWithParams\">\n                                    {{ $t('Panels.MacrosPanel.Send') }}\n                                </v-btn>\n                            </v-col>\n                        </v-row>\n                    </v-card-text>\n                </v-card>\n            </v-menu>\n        </template>\n    </v-item-group>\n</template>\n\n<script lang=\"ts\">\nimport Component from 'vue-class-component'\nimport {Mixins, Prop, Watch} from 'vue-property-decorator'\nimport BaseMixin from '@/components/mixins/base'\nimport {GuiMacrosStateMacrogroupMacro} from '@/store/gui/macros/types'\n\ninterface param {\n    type: 'int' | 'double' | 'string' | null,\n    default: string | number | null\n    value: string | number | null\n}\n\ninterface params {\n    [key: string]: param\n}\n\n@Component\nexport default class MacroButton extends Mixins(BaseMixin) {\n    private paramArray: string[] = []\n    private params: params = {}\n\n    @Prop({ required: true }) readonly macro!: GuiMacrosStateMacrogroupMacro\n    @Prop({ default: 'primary' }) readonly color!: string\n\n    get klipperMacro() {\n        return this.$store.getters['printer/getMacro'](this.macro.name)\n    }\n\n    @Watch('klipperMacro')\n    klipperMacroChange() {\n        this.refreshParams()\n    }\n\n    refreshParams() {\n        this.paramArray.splice(0, this.paramArray.length)\n        this.params = {}\n\n        if (this.klipperMacro.params !== null) {\n            Object.keys(this.klipperMacro.params).forEach((name: string) => {\n                if (!name.startsWith('_')) {\n                    this.paramArray.push(name)\n                    this.params[name] = {\n                        type: this.klipperMacro.params[name].type,\n                        default: this.klipperMacro.params[name].default,\n                        value: ''\n                    }\n                }\n            })\n        }\n    }\n\n    doSendMacro(gcode: string) {\n        this.$store.dispatch('server/addEvent', { message: gcode, type: 'command' })\n        this.$socket.emit('printer.gcode.script', { script: gcode }, { loading: 'macro_'+gcode })\n    }\n\n    sendWithParams() {\n        let params: string[] = []\n        this.paramArray.forEach((paramname: string) => {\n            if (this.params[paramname].value !== null && this.params[paramname].value !== '')\n                params.push(paramname+'='+this.params[paramname].value)\n        })\n\n        const gcode = this.macro.name + ' ' +params.join(' ')\n        this.doSendMacro(gcode)\n    }\n\n    mounted(){\n        this.refreshParams()\n    }\n}\n</script>"]}]}