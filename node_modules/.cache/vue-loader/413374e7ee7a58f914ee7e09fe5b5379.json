{"remainingRequest":"/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/src/components/TheUpdateDialog.vue?vue&type=script&lang=ts&","dependencies":[{"path":"/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/src/components/TheUpdateDialog.vue","mtime":1644874918000},{"path":"/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/node_modules/cache-loader/dist/cjs.js","mtime":1645990064605},{"path":"/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/node_modules/babel-loader/lib/index.js","mtime":1645990067759},{"path":"/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/node_modules/ts-loader/index.js","mtime":1645990068168},{"path":"/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/node_modules/cache-loader/dist/cjs.js","mtime":1645990064605},{"path":"/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1645990069130}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgppbXBvcnQgQ29tcG9uZW50IGZyb20gJ3Z1ZS1jbGFzcy1jb21wb25lbnQnCmltcG9ydCB7TWl4aW5zLCBXYXRjaH0gZnJvbSAndnVlLXByb3BlcnR5LWRlY29yYXRvcicKaW1wb3J0IEJhc2VNaXhpbiBmcm9tICdAL2NvbXBvbmVudHMvbWl4aW5zL2Jhc2UnCgpAQ29tcG9uZW50KHsKICAgIGNvbXBvbmVudHM6IHsKICAgIH0KfSkKZXhwb3J0IGRlZmF1bHQgY2xhc3MgVGhlVXBkYXRlRGlhbG9nIGV4dGVuZHMgTWl4aW5zKEJhc2VNaXhpbikgewogICAgJHJlZnMhOiB7CiAgICAgICAgdXBkYXRlckxvZ1Njcm9sbDogYW55CiAgICAgICAgdXBkYXRlckxvZzogSFRNTERpdkVsZW1lbnQKICAgIH0KCiAgICBoZWFkZXJzID0gWwogICAgICAgIHsKICAgICAgICAgICAgdGV4dDogJ0RhdGUnLAogICAgICAgICAgICB2YWx1ZTogJ2RhdGUnLAogICAgICAgICAgICB3aWR0aDogJzElJywKICAgICAgICAgICAgZGF0ZVR5cGU6ICdEYXRlJywKICAgICAgICB9LCB7CiAgICAgICAgICAgIHRleHQ6ICdNZXNzYWdlJywKICAgICAgICAgICAgc29ydGFibGU6IGZhbHNlLAogICAgICAgICAgICB2YWx1ZTogJ21lc3NhZ2UnLAogICAgICAgICAgICB3aWR0aDogJzk5JScKICAgICAgICB9LAogICAgXQoKICAgIGdldCBhcHBsaWNhdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy4kc3RvcmUuc3RhdGUuc2VydmVyLnVwZGF0ZU1hbmFnZXIudXBkYXRlUmVzcG9uc2UuYXBwbGljYXRpb24gPz8gJycKICAgIH0KCiAgICBnZXQgbWVzc2FnZXMoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuJHN0b3JlLnN0YXRlLnNlcnZlci51cGRhdGVNYW5hZ2VyLnVwZGF0ZVJlc3BvbnNlLm1lc3NhZ2VzID8/IFtdCiAgICB9CgogICAgZ2V0IGNvbXBsZXRlKCkgewogICAgICAgIHJldHVybiB0aGlzLiRzdG9yZS5zdGF0ZS5zZXJ2ZXIudXBkYXRlTWFuYWdlci51cGRhdGVSZXNwb25zZS5jb21wbGV0ZSA/PyB0cnVlCiAgICB9CgogICAgY3VzdG9tU29ydChpdGVtczogYW55W10sIGluZGV4OiBzdHJpbmcsIGlzRGVzYzogYm9vbGVhbltdKSB7CiAgICAgICAgaXRlbXMuc29ydCgoYSwgYikgPT4gewogICAgICAgICAgICBpZiAoaW5kZXhbMF0gPT09ICdkYXRlJykgewogICAgICAgICAgICAgICAgaWYgKCFpc0Rlc2NbMF0pIHJldHVybiBuZXcgRGF0ZShiW2luZGV4XSkuZ2V0VGltZSgpIC0gIG5ldyBEYXRlKGFbaW5kZXhdKS5nZXRUaW1lKCkKICAgICAgICAgICAgICAgIGVsc2UgcmV0dXJuIG5ldyBEYXRlKGFbaW5kZXhdKS5nZXRUaW1lKCkgLSBuZXcgRGF0ZShiW2luZGV4XSkuZ2V0VGltZSgpCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpZih0eXBlb2YgYVtpbmRleF0gIT09ICd1bmRlZmluZWQnKXsKICAgICAgICAgICAgICAgICAgICBpZiAoIWlzRGVzY1swXSkgcmV0dXJuIGFbaW5kZXhdLnRvTG93ZXJDYXNlKCkubG9jYWxlQ29tcGFyZShiW2luZGV4XS50b0xvd2VyQ2FzZSgpKQogICAgICAgICAgICAgICAgICAgIGVsc2UgcmV0dXJuIGJbaW5kZXhdLnRvTG93ZXJDYXNlKCkubG9jYWxlQ29tcGFyZShhW2luZGV4XS50b0xvd2VyQ2FzZSgpKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSkKCiAgICAgICAgcmV0dXJuIGl0ZW1zCiAgICB9CgogICAgZm9ybWF0VGltZShkYXRlOiBEYXRlKSB7CiAgICAgICAgY29uc3QgaG91cnMgPSAoZGF0ZS5nZXRIb3VycygpIDwgMTApID8gJzAnK2RhdGUuZ2V0SG91cnMoKS50b1N0cmluZygpIDogZGF0ZS5nZXRIb3VycygpCiAgICAgICAgY29uc3QgbWludXRlcyA9IChkYXRlLmdldE1pbnV0ZXMoKSA8IDEwKSA/ICcwJytkYXRlLmdldE1pbnV0ZXMoKS50b1N0cmluZygpIDogZGF0ZS5nZXRNaW51dGVzKCkKICAgICAgICBjb25zdCBzZWNvbmRzID0gKGRhdGUuZ2V0U2Vjb25kcygpIDwgMTApID8gJzAnK2RhdGUuZ2V0U2Vjb25kcygpLnRvU3RyaW5nKCkgOiBkYXRlLmdldFNlY29uZHMoKQoKICAgICAgICByZXR1cm4gaG91cnMrJzonK21pbnV0ZXMrJzonK3NlY29uZHMKICAgIH0KCiAgICBjbG9zZSgpIHsKICAgICAgICBpZiAodGhpcy5hcHBsaWNhdGlvbiAhPT0gbnVsbCAmJiB0aGlzLmNvbXBsZXRlICYmIFsnY2xpZW50JywgJ21haW5zYWlsJywgJ2Z1bGwnXS5pbmNsdWRlcyh0aGlzLmFwcGxpY2F0aW9uLnRvTG93ZXJDYXNlKCkpKSB3aW5kb3cubG9jYXRpb24ucmVsb2FkKHRydWUpCiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHRoaXMuJHN0b3JlLmNvbW1pdCgnc2VydmVyL3VwZGF0ZU1hbmFnZXIvcmVzZXRVcGRhdGVSZXNwb25zZScpCiAgICAgICAgICAgIHRoaXMuJHNvY2tldC5lbWl0KCdtYWNoaW5lLnVwZGF0ZS5zdGF0dXMnLCB7IHJlZnJlc2g6IGZhbHNlIH0sIHsgYWN0aW9uOiAnc2VydmVyL3VwZGF0ZU1hbmFnZXIvZ2V0U3RhdHVzJyB9KQogICAgICAgIH0KICAgIH0KCiAgICBAV2F0Y2goJ21lc3NhZ2VzJykKICAgIG1lc3NhZ2VzQ2hhbmdlZCgpIHsKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gewogICAgICAgICAgICAgICAgaWYgKHRoaXMuJHJlZnMudXBkYXRlckxvZ1Njcm9sbCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IG92ZXJsYXlzY3JvbGwgPSB0aGlzLiRyZWZzLnVwZGF0ZXJMb2dTY3JvbGwub3NJbnN0YW5jZSgpCiAgICAgICAgICAgICAgICAgICAgb3ZlcmxheXNjcm9sbD8uc2Nyb2xsKHsgeTogJzEwMCUnIH0pCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgfSwgNTApCiAgICB9Cn0K"},{"version":3,"sources":["TheUpdateDialog.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4FA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"TheUpdateDialog.vue","sourceRoot":"src/components","sourcesContent":["<style scoped>\n    .updaterLogScroll {\n        height: 350px;\n        max-height: 350px;\n        overflow-x: hidden;\n    }\n\n    .updaterLog .title-cell {\n        white-space: nowrap;\n        vertical-align: top;\n    }\n\n    .updaterLog.v-data-table > .v-data-table__wrapper > table > tbody > tr > td {\n        height: auto;\n    }\n</style>\n\n<template>\n    <v-dialog :value=\"application !== ''\" persistent max-width=\"800\" class=\"mx-0\">\n        <v-card\n            dark\n            :loading=\"!complete\"\n        >\n            <template slot=\"progress\">\n                <v-progress-linear color=\"primary\" indeterminate></v-progress-linear>\n            </template>\n            <v-toolbar flat dense >\n                <v-toolbar-title>\n                    <span class=\"subheading\">\n                        <v-icon left>mdi-update</v-icon>\n                        <template v-if=\"application.substr(0, 8) === 'recover_' && !complete\">\n                            {{ $t(\"App.UpdateDialog.Recovering\", { software: application.substr(8) }) }}\n                        </template>\n                        <template v-else-if=\"application.substr(0, 8) === 'recover_'\">\n                            {{ $t(\"App.UpdateDialog.RecoveringDone\", { software: application.substr(8) }) }}\n                        </template>\n                        <template v-else-if=\"!complete\">\n                            {{ $t(\"App.UpdateDialog.Updating\", { software: application }) }}\n                        </template>\n                        <template v-else>\n                            {{ $t(\"App.UpdateDialog.UpdatingDone\", { software: application }) }}\n                        </template>\n                    </span>\n                </v-toolbar-title>\n            </v-toolbar>\n            <v-card-text class=\"px-3\">\n                <v-row>\n                    <v-col class=\"py-6 px-0\">\n                        <overlay-scrollbars class=\"updaterLogScroll\" ref=\"updaterLogScroll\">\n                            <v-data-table\n                                :headers=\"headers\"\n                                :items=\"messages\"\n                                item-key=\"date\"\n                                hide-default-footer\n                                hide-default-header\n                                disable-pagination\n                                class=\"updaterLog\"\n                                ref=\"updaterLog\"\n                                :custom-sort=\"customSort\"\n                                sort-by=\"date\"\n                                :sort-desc=\"true\"\n                                color=\"primary\"\n                            >\n                                <template #no-data>\n                                    <div class=\"py-2\">{{ $t(\"App.UpdateDialog.Empty\")}}</div>\n                                </template>\n\n                                <template #item=\"{ item }\">\n                                    <tr>\n                                        <td class=\"log-cell title-cell py-2\">\n                                            {{ formatTime(item.date)}}\n                                        </td>\n                                        <td class=\"log-cell content-cell pl-0 py-2\" colspan=\"2\" style=\"width:100%;\">\n                                            <span v-if=\"item.message\" class=\"message\" v-html=\"item.message\"></span>\n                                        </td>\n                                    </tr>\n                                </template>\n                            </v-data-table>\n                        </overlay-scrollbars>\n                    </v-col>\n                </v-row>\n                <v-row>\n                    <v-col class=\"text-center pt-5\">\n                        <v-btn text @click=\"close\" :disabled=\"!complete\" color=\"primary\">{{ $t(\"App.UpdateDialog.Close\")}}</v-btn>\n                    </v-col>\n                </v-row>\n            </v-card-text>\n        </v-card>\n    </v-dialog>\n</template>\n\n<script lang=\"ts\">\nimport Component from 'vue-class-component'\nimport {Mixins, Watch} from 'vue-property-decorator'\nimport BaseMixin from '@/components/mixins/base'\n\n@Component({\n    components: {\n    }\n})\nexport default class TheUpdateDialog extends Mixins(BaseMixin) {\n    $refs!: {\n        updaterLogScroll: any\n        updaterLog: HTMLDivElement\n    }\n\n    headers = [\n        {\n            text: 'Date',\n            value: 'date',\n            width: '1%',\n            dateType: 'Date',\n        }, {\n            text: 'Message',\n            sortable: false,\n            value: 'message',\n            width: '99%'\n        },\n    ]\n\n    get application() {\n        return this.$store.state.server.updateManager.updateResponse.application ?? ''\n    }\n\n    get messages() {\n        return this.$store.state.server.updateManager.updateResponse.messages ?? []\n    }\n\n    get complete() {\n        return this.$store.state.server.updateManager.updateResponse.complete ?? true\n    }\n\n    customSort(items: any[], index: string, isDesc: boolean[]) {\n        items.sort((a, b) => {\n            if (index[0] === 'date') {\n                if (!isDesc[0]) return new Date(b[index]).getTime() -  new Date(a[index]).getTime()\n                else return new Date(a[index]).getTime() - new Date(b[index]).getTime()\n            } else {\n                if(typeof a[index] !== 'undefined'){\n                    if (!isDesc[0]) return a[index].toLowerCase().localeCompare(b[index].toLowerCase())\n                    else return b[index].toLowerCase().localeCompare(a[index].toLowerCase())\n                }\n            }\n        })\n\n        return items\n    }\n\n    formatTime(date: Date) {\n        const hours = (date.getHours() < 10) ? '0'+date.getHours().toString() : date.getHours()\n        const minutes = (date.getMinutes() < 10) ? '0'+date.getMinutes().toString() : date.getMinutes()\n        const seconds = (date.getSeconds() < 10) ? '0'+date.getSeconds().toString() : date.getSeconds()\n\n        return hours+':'+minutes+':'+seconds\n    }\n\n    close() {\n        if (this.application !== null && this.complete && ['client', 'mainsail', 'full'].includes(this.application.toLowerCase())) window.location.reload(true)\n        else {\n            this.$store.commit('server/updateManager/resetUpdateResponse')\n            this.$socket.emit('machine.update.status', { refresh: false }, { action: 'server/updateManager/getStatus' })\n        }\n    }\n\n    @Watch('messages')\n    messagesChanged() {\n        setTimeout(() => {\n            this.$nextTick(() => {\n                if (this.$refs.updaterLogScroll) {\n                    const overlayscroll = this.$refs.updaterLogScroll.osInstance()\n                    overlayscroll?.scroll({ y: '100%' })\n                }\n            })\n        }, 50)\n    }\n}\n</script>"]}]}