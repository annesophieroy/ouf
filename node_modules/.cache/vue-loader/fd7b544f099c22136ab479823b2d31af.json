{"remainingRequest":"/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/src/components/panels/MiniconsolePanel.vue?vue&type=style&index=0&id=52d25fb8&scoped=true&lang=scss&","dependencies":[{"path":"/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/src/components/panels/MiniconsolePanel.vue","mtime":1644874918000},{"path":"/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/node_modules/@vue/cli-service/node_modules/css-loader/dist/cjs.js","mtime":1645990066541},{"path":"/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/node_modules/@vue/cli-service/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1645990070825},{"path":"/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/node_modules/postcss-loader/src/index.js","mtime":1645990067674},{"path":"/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/node_modules/sass-loader/dist/cjs.js","mtime":1645990064431},{"path":"/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/node_modules/cache-loader/dist/cjs.js","mtime":1645990064605},{"path":"/Users/anne-sophieroy/Downloads/Mainsail/mainsail-maintenance/node_modules/@vue/cli-service/node_modules/vue-loader/lib/index.js","mtime":1645990069130}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgouY29uc29sZVRhYmxlIHsKICAgIGJvcmRlci10b3A6IDFweCBzb2xpZCByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuMTIpOwp9CgouZ2NvZGUtY29tbWFuZC1maWVsZCB7CiAgICBmb250LWZhbWlseTogJ1JvYm90byBNb25vJywgbW9ub3NwYWNlOwp9Cg=="},{"version":3,"sources":["MiniconsolePanel.vue"],"names":[],"mappings":";;AAEA;AACA;AACA;;AAEA;AACA;AACA","file":"MiniconsolePanel.vue","sourceRoot":"src/components/panels","sourcesContent":["<style scoped lang=\"scss\">\n\n    .consoleTable {\n        border-top: 1px solid rgba(255, 255, 255, 0.12);\n    }\n\n    .gcode-command-field {\n        font-family: 'Roboto Mono', monospace;\n    }\n</style>\n\n<template>\n    <panel\n        v-if=\"socketIsConnected && klipperState !== 'disconnected'\"\n        icon=\"mdi-console-line\"\n        :title=\"$t('Panels.MiniconsolePanel.Headline')\"\n        :collapsible=\"true\"\n        card-class=\"miniconsole-panel\"\n        :hideButtonsOnCollapse=\"true\"\n    >\n        <template v-slot:buttons>\n            <command-help-modal @onCommand=\"gcode = $event\" :inToolbar=\"true\" ></command-help-modal>\n\n            <v-menu :offset-y=\"true\" :close-on-content-click=\"false\" :title=\"$t('Panels.MiniconsolePanel.SetupConsole')\">\n                <template v-slot:activator=\"{ on, attrs }\">\n                    <v-btn icon tile v-bind=\"attrs\" v-on=\"on\"><v-icon small>mdi-filter</v-icon></v-btn>\n                </template>\n                <v-list>\n                    <v-list-item class=\"minHeight36\">\n                        <v-checkbox class=\"mt-0\" v-model=\"hideWaitTemperatures\" hide-details :label=\"$t('Panels.MiniconsolePanel.HideTemperatures')\"></v-checkbox>\n                    </v-list-item>\n                    <v-list-item class=\"minHeight36\" v-if=\"moonrakerComponents.includes('timelapse')\">\n                        <v-checkbox class=\"mt-0\" v-model=\"hideTlCommands\" hide-details :label=\"$t('Panels.MiniconsolePanel.HideTimelapse')\"></v-checkbox>\n                    </v-list-item>\n                    <v-list-item class=\"minHeight36\" v-for=\"(filter, index) in customFilters\" v-bind:key=\"index\">\n                        <v-checkbox class=\"mt-0\" v-model=\"filter.bool\" @change=\"toggleFilter(filter)\" hide-details :label=\"filter.name\"></v-checkbox>\n                    </v-list-item>\n                </v-list>\n            </v-menu>\n\n        </template>\n        <div class=\"d-flex flex-column\">\n            <v-card-text :class=\"consoleDirection === 'table' ? 'order-1' : 'order-2'\">\n                <v-textarea\n                    v-model=\"gcode\"\n                    :items=\"items\"\n                    :label=\"$t('Panels.MiniconsolePanel.SendCode')\"\n                    solo\n                    class=\"gcode-command-field\"\n                    ref=\"gcodeCommandField\"\n                    autocomplete=\"off\"\n                    no-resize\n                    auto-grow\n                    :rows=\"rows\"\n                    @keydown.enter.prevent.stop=\"doSend\"\n                    @keyup.up=\"onKeyUp\"\n                    @keyup.down=\"onKeyDown\"\n                    @keydown.tab=\"getAutocomplete\"\n                    hide-details\n                    outlined\n                    dense\n                    :prepend-icon=\"isTouchDevice ? 'mdi-chevron-double-right' : ''\"\n                    @click:prepend=\"getAutocomplete\"\n                    append-icon=\"mdi-send\"\n                    @click:append=\"doSend\"\n                ></v-textarea>\n            </v-card-text>\n            <v-card-text :class=\"(consoleDirection === 'table' ? 'order-2' : 'order-1') + ' pa-0'\">\n                <v-row>\n                    <v-col>\n                        <overlay-scrollbars ref=\"miniConsoleScroll\" :style=\"'height: '+consoleHeight+'px;'\" :options=\"{ }\">\n                            <console-table ref=\"console\"\n                                           :events=\"events\"\n                                           :is-mini=\"true\"\n                                           @command-click=\"commandClick\"\n                            />\n                            <v-divider></v-divider>\n                        </overlay-scrollbars>\n                    </v-col>\n                </v-row>\n            </v-card-text>\n        </div>\n    </panel>\n</template>\n\n<script lang=\"ts\">\nimport { strLongestEqual, reverseString} from '@/plugins/helpers'\nimport {Component, Mixins, Watch} from 'vue-property-decorator'\nimport BaseMixin from '@/components/mixins/base'\nimport {CommandHelp, VTextareaType} from '@/store/printer/types'\nimport ConsoleTable from '@/components/console/ConsoleTable.vue'\nimport CommandHelpModal from '@/components/CommandHelpModal.vue'\nimport Panel from '@/components/ui/Panel.vue'\n\n@Component({\n    components: {\n        Panel,\n        ConsoleTable,\n        CommandHelpModal\n    }\n})\nexport default class MiniconsolePanel extends Mixins(BaseMixin) {\n    $refs!: {\n        gcodeCommandField: VTextareaType,\n        console: ConsoleTable,\n        miniConsoleScroll: any\n    }\n\n    private gcode = ''\n    private lastCommandNumber: number | null = null\n    private items = [];\n    private cmdListSearch: string | null = null\n\n    get helplist(): CommandHelp[] {\n        return this.$store.state.printer.helplist ?? []\n    }\n\n    get consoleDirection() {\n        return this.$store.state.gui.console.direction ?? 'table'\n    }\n\n    get consoleHeight() {\n        return this.$store.state.gui.console.height ?? 300\n    }\n\n    get events() {\n        return this.$store.getters['server/getConsoleEvents'](this.consoleDirection === 'table', 250)\n    }\n\n\n    @Watch('events')\n    eventsChanged() {\n        if (this.consoleDirection === 'shell'){\n            setTimeout(() => {\n                this.scrollToBottom()\n            }, 50)\n        }\n    }\n\n    get hideWaitTemperatures(): boolean {\n        return this.$store.state.gui.console.hideWaitTemperatures\n    }\n\n    set hideWaitTemperatures(newVal) {\n        this.$store.dispatch('gui/saveSetting', { name: 'console.hideWaitTemperatures', value: newVal })\n    }\n\n    get hideTlCommands(): boolean {\n        return this.$store.state.gui.console.hideTlCommands\n    }\n\n    set hideTlCommands(newVal) {\n        this.$store.dispatch('gui/saveSetting', { name: 'console.hideTlCommands', value: newVal })\n    }\n\n    get customFilters(): any[] {\n        return this.$store.state.gui.console.consolefilters\n    }\n\n    get rows(): number {\n        return this.gcode?.split('\\n').length ?? 1\n    }\n\n    get lastCommands(): string[] {\n        return this.$store.state.gui.gcodehistory.entries ?? []\n    }\n\n    commandClick(msg: string): void {\n        this.gcode = msg\n\n        this.$nextTick(() => {\n            this.$refs.gcodeCommandField.focus()\n        })\n    }\n\n    doSend(cmd: KeyboardEvent) {\n        if (!cmd.shiftKey) {\n            if (this.gcode !== '') {\n                this.$store.dispatch('printer/sendGcode', this.gcode)\n                this.$store.dispatch('gui/gcodehistory/addToHistory', this.gcode)\n                this.gcode = ''\n                this.lastCommandNumber = null\n                setTimeout(() => {\n                    this.$refs.console.$el.scroll({\n                        top: 0,\n                        left: 0,\n                        behavior: 'smooth'\n                    })\n                }, 20)\n            }\n        } else {\n            this.gcode += '\\n'\n        }\n    }\n\n    onKeyUp(): void {\n        if (this.lastCommandNumber === null && this.lastCommands.length) {\n            this.lastCommandNumber = this.lastCommands.length - 1\n            this.gcode = this.lastCommands[this.lastCommandNumber]\n        } else if (this.lastCommandNumber && this.lastCommandNumber > 0) {\n            this.lastCommandNumber--\n            this.gcode = this.lastCommands[this.lastCommandNumber]\n        }\n    }\n\n    onKeyDown(): void {\n        if (this.lastCommandNumber !== null && this.lastCommandNumber < (this.lastCommands.length - 1)) {\n            this.lastCommandNumber++\n            this.gcode = this.lastCommands[this.lastCommandNumber]\n        } else if (this.lastCommandNumber !== null && this.lastCommandNumber === (this.lastCommands.length - 1)) {\n            this.lastCommandNumber = null\n            this.gcode = ''\n        }\n    }\n\n    getAutocomplete(e: Event): void {\n        e.preventDefault()\n        if (this.gcode.length) {\n            let check = this.gcode.toLowerCase()\n            const textarea = this.$refs.gcodeCommandField.$refs.input\n            const sentence = textarea.value\n            const len = sentence.length\n            const pos = textarea.selectionStart\n            const currentLinePos = len - reverseString(sentence).indexOf('\\n', len - pos)\n            const currentEndPos = sentence.indexOf('\\n', currentLinePos) > -1 ? sentence.indexOf('\\n', currentLinePos) - 1 : Number.MAX_SAFE_INTEGER\n            if (this.rows > 1) {\n                check = sentence.substr(currentLinePos, currentEndPos - currentLinePos)\n            }\n            let commands = this.helplist.filter((element) => element.commandLow.startsWith(check.toLowerCase()))\n            if (commands?.length === 1) {\n                if (this.rows > 1) {\n                    this.gcode = this.gcode.replace(check, commands[0].command)\n                } else {\n                    this.gcode = commands[0].command\n                }\n            } else if(commands?.length > 1) {\n                let commands = this.helplist.filter((element) => element.commandLow.startsWith(check.toLowerCase()))\n                if (this.rows > 1) {\n                    this.gcode = this.gcode.replace(check, commands.reduce((acc, val) => {\n                        return strLongestEqual(acc, val.command)\n                    }, commands[0].command))\n                } else {\n                    this.gcode = commands.reduce((acc, val) => {\n                        return strLongestEqual(acc, val.command)\n                    }, commands[0].command)\n                }\n                if (commands && commands.length) {\n                    let output = ''\n                    commands.forEach(command => output += '<a class=\"command blue--text font-weight-bold\">'+command.command+'</a>: '+command.description+'<br />')\n\n                    this.$store.dispatch('server/addEvent', { message: output, type: 'autocomplete' })\n                }\n            }\n        }\n        this.$refs.gcodeCommandField.focus()\n    }\n\n    toggleFilter(filter: string) {\n        this.$store.dispatch('gui/updateConsoleFilter',  filter)\n    }\n\n    mounted() {\n        if (this.consoleDirection === 'shell') this.scrollToBottom()\n    }\n\n    scrollToBottom() {\n        this.$nextTick(() => {\n            if (this.$refs.miniConsoleScroll) {\n                const overlayscroll = this.$refs.miniConsoleScroll.osInstance()\n                overlayscroll?.scroll({ y: '100%' })\n            }\n        })\n    }\n\n    scrollToTop() {\n        this.$nextTick(() => {\n            if (this.$refs.miniConsoleScroll) {\n                const overlayscroll = this.$refs.miniConsoleScroll.osInstance()\n                overlayscroll?.scroll({ y: '0%' })\n            }\n        })\n    }\n}\n</script>\n"]}]}